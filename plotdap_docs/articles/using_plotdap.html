<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using plotdap • plotdap</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using plotdap">
<meta property="og:description" content="plotdap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">plotdap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/using_plotdap.html">Using plotdap</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rmendels/plotdap/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using plotdap</h1>
                        <h4 data-toc-skip class="author"></h4>
            
            <h4 data-toc-skip class="date">2023-10-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rmendels/plotdap/blob/HEAD/vignettes/using_plotdap.Rmd" class="external-link"><code>vignettes/using_plotdap.Rmd</code></a></small>
      <div class="hidden name"><code>using_plotdap.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="plotdap">plotdap<a class="anchor" aria-label="anchor" href="#plotdap"></a>
</h2>
<p>The R package <strong>plotdap</strong> makes it easy to visualize
‘tabledap’ and ‘griddap’ objects obtained via the <a href="https://CRAN.R-project.org/package=rerddap" class="external-link"><strong>rerddap</strong></a>
package. Maps can be made using either base or ggplot2 graphics, and the
user does not need to know the intricacies of obtaining continental
outlines, projections, and combining those with the data to form maps.
Animations of the data are also readily obtained. <code>plotdap</code>
works in a similar fashion with either tables or grids return by
<code>rerddap</code> further simplifying the mapping process.</p>
<p>A user who desires fine control of their maps should learn how to map
the data themselves - some examples are give in the <code>rerddap</code>
vignette. But <code>plotdap</code> provides a simplified workflow of
obtaining data using <code>rerddap</code> and quickly and simply mapping
the data. In what follows we go over how to install <code>plotdap</code>
and it’s basic usage, as well as how to utilize some of the more
important options in the package in order to improve the map.</p>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p><strong>plotdap</strong> can be installed from CRAN with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"plotdap"</span><span class="op">)</span></span></code></pre></div>
<p>and the development version can be installed with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">'ropensci/plotdap'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="getting-started-with-plotdap">Getting started with <code>plotdap()</code><a class="anchor" aria-label="anchor" href="#getting-started-with-plotdap"></a>
</h3>
<p>The <code><a href="../reference/plotdap.html">plotdap()</a></code> function makes it easy to visualize data
acquired via <code><a href="https://docs.ropensci.org/rerddap/reference/tabledap.html" class="external-link">rerddap::tabledap()</a></code> or
<code><a href="https://docs.ropensci.org/rerddap/reference/griddap.html" class="external-link">rerddap::griddap()</a></code>. Regardless of the data you want to
visualize, you’ll always want to start a plot via
<code><a href="../reference/plotdap.html">plotdap()</a></code>, where you may specify some “global” plotting
options. Subsequent sections will demonstrate how to add tables/grids
via <code><a href="../reference/add_tabledap.html">add_tabledap()</a></code>/<code><a href="../reference/add_griddap.html">add_griddap()</a></code>, but for now
we’ll focus on options provided by <code><a href="../reference/plotdap.html">plotdap()</a></code>. Most
importantly, the first argument decides whether base ‘R’ graphics or <a href="https://cran.r-project.org/package=ggplot2" class="external-link">ggplot2</a> graphics
should be used for the actual plotting.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rmendels/plotdap" class="external-link">plotdap</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="using_plotdap_files/figure-html/world-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span><span class="st">"base"</span><span class="op">)</span></span></code></pre></div>
<p><img src="using_plotdap_files/figure-html/world-2.png" width="480" style="display: block; margin: auto;"></p>
<p>In addition to choosing a plotting method, <code><a href="../reference/plotdap.html">plotdap()</a></code> is
where you can define properties of the background map, including the
target projection using a valid coordinate reference system (CRS)
definition. Projection is performed using the <a href="https://proj.org/" class="external-link">PROJ.4 library</a>, and <a href="https://www.spatialreference.org" class="external-link">spatialreference.org</a> is a
great resource for finding PROJ.4 CRS descriptions. Using the search
utility, you can for example, <a href="https://spatialreference.org/ref/sr-org/?search=South+Pole&amp;srtext=Search" class="external-link">search
for “South Pole”</a> and pick from a number of options. Here I’ve chosen
the <a href="https://spatialreference.org/ref/sr-org/8375/" class="external-link">MODIS South
Pole Stereographic</a> option and copy-pasted the <a href="https://spatialreference.org/ref/sr-org/8375/proj4/" class="external-link">Proj4
page</a> with the CRS definition:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span><span class="st">"base"</span>,</span>
<span>  mapTitle <span class="op">=</span> <span class="st">"MODIS South Pole Stereographic"</span>, </span>
<span>  mapFill <span class="op">=</span> <span class="st">"transparent"</span>, </span>
<span>  mapColor <span class="op">=</span> <span class="st">"steelblue"</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"+proj=stere +lat_0=-90 +lat_ts=-90 +lon_0=-63 +k=1 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="using_plotdap_files/figure-html/southPole-1.png" width="480" style="display: block; margin: auto;"></p>
<p>You might notice that some projections aren’t “well-defined” on a
global scale, and thus, may result in an error, or a “broken” looking
map. For instance, <a href="https://spatialreference.org/ref/epsg/3467/" class="external-link">this Albers
projection centered on Alaska</a>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alaska</span> <span class="op">&lt;-</span> <span class="st">"+proj=aea +lat_1=55 +lat_2=65 +lat_0=50 +lon_0=-154 +x_0=0 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"</span></span>
<span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span><span class="st">"base"</span>, crs <span class="op">=</span> <span class="va">alaska</span><span class="op">)</span></span></code></pre></div>
<p><img src="using_plotdap_files/figure-html/alaska-1.png" width="480" style="display: block; margin: auto;"></p>
<p>That does not mean we can’t use this (or similar) projections – we
just have to be careful that they are sensible given the lat/lon limits.
By default, those limits span the entire world, but as we’ll see later,
the limits are shrunk to the given data (i.e., <code>griddap()</code> /
<code>tabledap()</code>) limits. In other words, we should expect this
projection to work once we “add” some data located near Alaska to the
visualization. However, in case you want to make a map without any data,
or want to customize the background map in some special way, you can
supply an <a href="https://CRAN.R-project.org/package=sf" class="external-link"><strong>sf</strong></a>
object (or something coercable to an <strong>sf</strong> object) to the
<code>mapData</code> argument.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mapdata</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"world"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">us</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">w</span>, <span class="va">ID</span> <span class="op">==</span> <span class="st">"USA"</span><span class="op">)</span>, <span class="va">alaska</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapData <span class="op">=</span> <span class="va">us</span><span class="op">)</span></span></code></pre></div>
<p><img src="using_plotdap_files/figure-html/usmap-1.png" width="480" style="display: block; margin: auto;"></p>
<p>With the odd exception of window sizing and projections, the options
in <code><a href="../reference/plotdap.html">plotdap()</a></code> should <em>just work</em> in a similar way for
either plotting method. However, there are some useful options that are
deliberately left out, since they work differently based on the plotting
method.</p>
<p>The <code>mapData</code> argument can be used to change the
resolution of the continental outlines or to limit the outline to a
pre-selected area, which can speed up processing because fewer unused
polygons need to be clipped. This is particularly important for maps
that will cross the dateline. So for example to use the hi-res outlines
for VIIIRS SST off the coast of North America:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sstInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">'erdVHsstaWS3day'</span><span class="op">)</span></span>
<span><span class="co"># get latest 3-day composite sst</span></span>
<span><span class="va">viirsSST</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/griddap.html" class="external-link">griddap</a></span><span class="op">(</span><span class="va">sstInfo</span>, </span>
<span>                             latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">41.</span>, <span class="fl">31.</span><span class="op">)</span>, </span>
<span>                             longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">128.</span>, <span class="op">-</span><span class="fl">115</span><span class="op">)</span>, </span>
<span>                             time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'last'</span>,<span class="st">'last'</span><span class="op">)</span>, </span>
<span>                             fields <span class="op">=</span> <span class="st">'sst'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"worldHires"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">140.</span>, <span class="op">-</span><span class="fl">114</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.</span>, <span class="fl">42.</span><span class="op">)</span>, </span>
<span>         fill <span class="op">=</span> <span class="cn">TRUE</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># map using that outline,  temperature color from cmocean</span></span>
<span><span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapData <span class="op">=</span> <span class="va">w</span><span class="op">)</span>, <span class="va">viirsSST</span>, <span class="op">~</span><span class="va">sst</span>, fill <span class="op">=</span> <span class="st">"thermal"</span> <span class="op">)</span></span></code></pre></div>
<p><img src="viirs_hires.png"></p>
<p>Maps that cross the dateline work better using the “world2” or
“world2Hires” databases frpm the <code>mapdata</code> package. There is
a known problem with that continental database in that polygons from
certain countries cause artificial lines in the map, and must removed,
as done below.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">135.25</span>, <span class="fl">240.25</span><span class="op">)</span></span>
<span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20.25</span>, <span class="fl">60.25</span><span class="op">)</span></span>
<span><span class="va">zpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">70.02</span>, <span class="fl">70.02</span><span class="op">)</span></span>
<span><span class="va">remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UK:Great Britain"</span>, <span class="st">"France"</span>, <span class="st">"Spain"</span>, <span class="st">"Algeria"</span>, <span class="st">"Mali"</span>, <span class="st">"</span></span>
<span><span class="st">            Burkina Faso"</span>, <span class="st">"Ghana"</span>, <span class="st">"Togo"</span><span class="op">)</span></span>
<span><span class="co">#subset world2Hires with those countries removed</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"world2Hires"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, ylim <span class="op">=</span> <span class="va">ypos</span>, xlim <span class="op">=</span> <span class="va">xpos</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"world2Hires"</span>, regions <span class="op">=</span> <span class="va">w</span><span class="op">$</span><span class="va">names</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">w</span><span class="op">$</span><span class="va">names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">remove</span><span class="op">)</span><span class="op">]</span>, </span>
<span>         plot <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, ylim <span class="op">=</span> <span class="va">ypos</span>, xlim <span class="op">=</span> <span class="va">xpos</span><span class="op">)</span></span>
<span><span class="co"># plot result</span></span>
<span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapData <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span></code></pre></div>
<p><img src="using_plotdap_files/figure-html/world2Hires-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Since the result of <code><a href="../reference/plotdap.html">plotdap()</a></code> is always a map, it always
forces a fixed aspect ratio (i.e., <span class="math inline">\(\frac{height}{width}\)</span> of graph equals
<span class="math inline">\(r=\frac{latitude}{longitude}\)</span>). For
this reason, the current size of your graphics device may not be
sensible for the value of <span class="math inline">\(r\)</span> (for
instance, if <span class="math inline">\(r\)</span> is high, but the
height of the graphics device is small, you may see an error such as:
<code>polygon edge not found</code> since the device cannot possibly
render the result under the conditions). For a number of reasons,
<code><a href="../reference/plotdap.html">plotdap()</a></code> will not automatically resize your graphics
device; instead, it’s recommended that you use a reliable graphics
device such as Cairo, and use a height/width ratio close to <span class="math inline">\(r\)</span>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># write plot to disk using the Cairo package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rforge.net/Cairo/" class="external-link">Cairo</a></span><span class="op">)</span></span>
<span><span class="co"># (latitude limits) / (longitude limits)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">85</span> <span class="op">/</span> <span class="fl">120</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Cairo/man/Cairo.html" class="external-link">CairoPNG</a></span><span class="op">(</span><span class="st">"myPlot.png"</span>, height <span class="op">=</span> <span class="fl">400</span> <span class="op">*</span> <span class="va">r</span>, width <span class="op">=</span> <span class="fl">400</span>, res <span class="op">=</span> <span class="fl">96</span><span class="op">)</span></span>
<span><span class="co"># alter default margins for base plotting </span></span>
<span><span class="co"># (leaving just enough space for a title)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span><span class="st">"base"</span>, mapData <span class="op">=</span> <span class="va">us</span>, mapTitle <span class="op">=</span> <span class="st">"Albers projection of Alaska"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>More advanced users that know some base/ggplot2 plotting may want
more control of certain aspects of the plot (a later section –
Customizing <code><a href="../reference/plotdap.html">plotdap()</a></code> objects – covers this topic).</p>
</div>
<div class="section level3">
<h3 id="adding-tabledap-layers">Adding <code>tabledap()</code> layers<a class="anchor" aria-label="anchor" href="#adding-tabledap-layers"></a>
</h3>
<p>The <code><a href="../reference/add_tabledap.html">add_tabledap()</a></code> function allows you to add markers
that encode variable(s) obtained via <code>tabledap()</code> to an
existing <code><a href="../reference/plotdap.html">plotdap()</a></code> object. For example, suppose we have the
following <code>sardines</code> data, and wish to understand the
frequency of subsample counts:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_url</span> <span class="op">&lt;-</span> <span class="st">'https://coastwatch.pfeg.noaa.gov/erddap/'</span></span>
<span><span class="va">sardines</span> <span class="op">&lt;-</span> <span class="fu">tabledap</span><span class="op">(</span></span>
<span>  <span class="st">'FRDCPSTrawlLHHaulCatch'</span>,</span>
<span>  fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'latitude'</span>,  <span class="st">'longitude'</span>, <span class="st">'time'</span>, <span class="st">'scientific_name'</span>, </span>
<span>             <span class="st">'subsample_count'</span><span class="op">)</span>,</span>
<span>  <span class="st">'time&gt;=2010-01-01'</span>, <span class="st">'time&lt;=2012-01-01'</span>, <span class="st">'scientific_name="Sardinops sagax"'</span>,</span>
<span>   url <span class="op">=</span> <span class="va">my_url</span><span class="op">)</span></span></code></pre></div>
<p>At the very least, <code><a href="../reference/add_tabledap.html">add_tabledap()</a></code> needs a base map
(i.e., a <code><a href="../reference/plotdap.html">plotdap()</a></code> object), the <code>tabledap()</code>
data, and a <em>formula</em> defining the variable of interest (for
encoding the color of the markers). In R, you can create a formula by
prefixing <code>~</code> to some expression. This formula can simply
reference a variable already residing in the dataset (e.g.,
<code>~subsample_count</code>) or it can be a function of some variables
(e.g. <code>~log2(subsample_count)</code>):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_tabledap.html">add_tabledap</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=robin"</span>,  mapTitle <span class="op">=</span> <span class="st">"subsample count"</span><span class="op">)</span>, </span>
<span>  <span class="va">sardines</span>, </span>
<span>  <span class="op">~</span><span class="va">subsample_count</span></span>
<span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_tabledap.html">add_tabledap</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=robin"</span>, mapTitle <span class="op">=</span> <span class="st">"Log subsample count"</span><span class="op">)</span>, </span>
<span>  <span class="va">sardines</span>, </span>
<span>  <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log2</a></span><span class="op">(</span><span class="va">subsample_count</span><span class="op">)</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="va">p1</span></span>
<span><span class="va">p2</span></span></code></pre></div>
<p><img src="sardines.png"></p>
</div>
<div class="section level3">
<h3 id="modifying-tabledap-layers">Modifying <code>tabledap()</code> layers<a class="anchor" aria-label="anchor" href="#modifying-tabledap-layers"></a>
</h3>
<p>It is also easy to alter the color scale as well as the symbol type
and size in <code><a href="../reference/add_tabledap.html">add_tabledap()</a></code> via the <code>color</code>,
<code>shape</code> and <code>size</code> arguments.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_tabledap.html">add_tabledap</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=robin"</span>, mapTitle <span class="op">=</span> <span class="st">"Sardines - change color"</span><span class="op">)</span>, </span>
<span>  <span class="va">sardines</span>, </span>
<span>  <span class="op">~</span><span class="va">subsample_count</span>, </span>
<span>  color <span class="op">=</span> <span class="st">"dense"</span>, </span>
<span><span class="op">)</span></span>
<span><span class="va">p2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_tabledap.html">add_tabledap</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=robin"</span>, mapTitle <span class="op">=</span> <span class="st">"Sardines - change shape and size"</span><span class="op">)</span>, </span>
<span>  <span class="va">sardines</span>, </span>
<span>  <span class="op">~</span><span class="va">subsample_count</span>, </span>
<span>  shape <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  size <span class="op">=</span> <span class="fl">1.</span></span>
<span><span class="op">)</span></span>
<span><span class="va">p1</span></span>
<span><span class="va">p2</span></span></code></pre></div>
<p><img src="sardines2.png"></p>
<p>For further details about these arguments, please refer to the
documentation on <code><a href="../reference/add_tabledap.html">help(add_tabledap)</a></code>.</p>
</div>
<div class="section level3">
<h3 id="adding-griddap-layers">Adding <code>griddap()</code> layers<a class="anchor" aria-label="anchor" href="#adding-griddap-layers"></a>
</h3>
<p>Similar to <code><a href="../reference/add_tabledap.html">add_tabledap()</a></code>, the
<code><a href="../reference/add_griddap.html">add_griddap()</a></code> function makes it easy to add rasters (i.e.,
rectangular tiles) to a <code><a href="../reference/plotdap.html">plotdap()</a></code> object. To demonstrate,
lets obtain some of the latest sea surface temperatures along the
western coast of the US.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">murSST_west</span> <span class="op">&lt;-</span> <span class="fu">griddap</span><span class="op">(</span></span>
<span>  <span class="st">'jplMURSST41'</span>, </span>
<span>  latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">22</span>, <span class="fl">51</span><span class="op">)</span>, </span>
<span>  longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">140</span>, <span class="op">-</span><span class="fl">105</span><span class="op">)</span>,</span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'last'</span>, <span class="st">'last'</span><span class="op">)</span>, </span>
<span>  fields <span class="op">=</span> <span class="st">'analysed_sst'</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Again, similar to <code><a href="../reference/add_tabledap.html">add_tabledap()</a></code>,
<code><a href="../reference/add_griddap.html">add_griddap()</a></code> needs a base map (i.e., a
<code><a href="../reference/plotdap.html">plotdap()</a></code> object), the <code>griddap()</code> data, and a
<em>formula</em> defining the variable of interest (for encoding the
fill of the rectangles). The <code><a href="../reference/add_griddap.html">add_griddap()</a></code> function also
has a <code>maxpixels</code> argument which sets a maximum threshold for
the number of cells (i.e., pixels) to use before projection and plotting
occurs. Compared to ggplot2, base plotting is much more efficient at
rendering raster objects, so it might be worth increasing the threshold
in that case:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=robin"</span><span class="op">)</span>, </span>
<span>  <span class="va">murSST_west</span>, </span>
<span>  <span class="op">~</span><span class="va">analysed_sst</span>, </span>
<span>  maxpixels <span class="op">=</span> <span class="fl">50000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="murSST_west.png"></p>
<p>The <code>murSST_west</code> grid has a single time point (i.e.,
<code>length(unique(murSST_west$data$time)) == 1</code>), but what do we
do when there are multiple time points? In addition to animating
multiple grids (a la <code><a href="../reference/add_tabledap.html">add_tabledap()</a></code>), you also have the
option to summarize multiple grids into a single grid. To demonstrate,
lets grab some wind speeds measured along the west coast of the US.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wind</span> <span class="op">&lt;-</span> <span class="fu">griddap</span><span class="op">(</span></span>
<span>  <span class="st">'erdQMwindmday'</span>, </span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2016-04-16'</span>, <span class="st">'2016-06-16'</span><span class="op">)</span>,</span>
<span>  latitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">50</span><span class="op">)</span>, </span>
<span>  longitude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">210</span>, <span class="fl">240</span><span class="op">)</span>,</span>
<span>  fields <span class="op">=</span> <span class="st">'y_wind'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>When faced with multiple time periods, and
<code>animate = FALSE</code> (the default), the <code>time</code>
argument is used to reduce multiple grids (i.e., raster bricks) to a
single grid (i.e., a single raster layer). You can pass any R function
to the <code>time</code> argument, but when
<code>animate = FALSE</code>, you should take care to ensure the
function returns a single value. The default uses the
<code>mean(na.rm = TRUE)</code> function so that each cell represents
the average (in this case amongst three time points), but we could
easily set this to <code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var()</a></code> to get the variance for each
cell:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapTitle <span class="op">=</span> <span class="st">"Mean Meridional Wind"</span><span class="op">)</span>, </span>
<span>  <span class="va">wind</span>, </span>
<span>  <span class="op">~</span><span class="va">y_wind</span>, </span>
<span>  fill <span class="op">=</span> <span class="st">"delta"</span>, </span>
<span>  time <span class="op">=</span> <span class="va">mean</span></span>
<span><span class="op">)</span> </span>
<span><span class="va">my_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapTitle <span class="op">=</span> <span class="st">"Variance of Meridional Wind"</span><span class="op">)</span>, </span>
<span>  <span class="va">wind</span>, </span>
<span>  <span class="op">~</span><span class="va">y_wind</span>, </span>
<span>  fill <span class="op">=</span> <span class="st">"delta"</span>, </span>
<span>  time <span class="op">=</span> <span class="va">my_func</span></span>
<span><span class="op">)</span> </span>
<span><span class="va">p1</span></span>
<span><span class="va">p2</span></span></code></pre></div>
<p><img src="winds.png"></p>
<div class="section level4">
<h4 id="changing-the-layer-order">Changing the layer order<a class="anchor" aria-label="anchor" href="#changing-the-layer-order"></a>
</h4>
<p>By default, <code>add_griddap</code> plots the land first and then
the grid on top of that. For many uses that is desirable, but at other
times it is more desirable to have the land mask the grid. This can now
be done in the print method, by saving the <code>plotdap</code> object
and printing with the option “landmask = TRUE”.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapTitle <span class="op">=</span> <span class="st">"Grid over Land"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>        <span class="va">viirsSST</span>, </span>
<span>        <span class="op">~</span><span class="va">sst</span>, </span>
<span>        fill <span class="op">=</span> <span class="st">"thermal"</span></span>
<span>        <span class="op">)</span></span></code></pre></div>
<p><img src="viirsSST_gridland.png"></p>
<p>and compare when land is plotted over the grid:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapTitle <span class="op">=</span> <span class="st">"Land Over Grid"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>      <span class="va">viirsSST</span>, </span>
<span>      <span class="op">~</span><span class="va">sst</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">"thermal"</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>landmask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="viirsSST_landgrid.png"></p>
</div>
<div class="section level4">
<h4 id="maxpixels">maxpixels<a class="anchor" aria-label="anchor" href="#maxpixels"></a>
</h4>
<p>Images of satellite data can contain a large number of pixels.
<code><a href="../reference/add_griddap.html">add_griddap()</a></code> allows for a differing number of pixels to be
used (default is 10,000) by setting the parameter “maxpixels”. When the
actual number pixels is larger than the value of “maxpixels”, the image
is sub-sampled. This can greatly affect the how the image looks.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapTitle <span class="op">=</span> <span class="st">"maxpixels = 10,000"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>      <span class="va">viirsSST</span>, </span>
<span>      <span class="op">~</span><span class="va">sst</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">"thermal"</span>,</span>
<span>      maxpixels <span class="op">=</span> <span class="fl">10000</span> </span>
<span>      <span class="op">)</span></span></code></pre></div>
<p><img src="viirsSST_10000.png"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapTitle <span class="op">=</span> <span class="st">"maxpixels = 50,000"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>     <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>       <span class="va">viirsSST</span>, </span>
<span>       <span class="op">~</span><span class="va">sst</span>, </span>
<span>       fill <span class="op">=</span> <span class="st">"thermal"</span>, </span>
<span>       maxpixels <span class="op">=</span> <span class="fl">50000</span></span>
<span>       <span class="op">)</span></span></code></pre></div>
<p><img src="viirsSST_50000.png"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapTitle <span class="op">=</span> <span class="st">"maxpixels = 100,000"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>      <span class="va">viirsSST</span>, </span>
<span>      <span class="op">~</span><span class="va">sst</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">"thermal"</span>,  </span>
<span>      maxpixels <span class="op">=</span> <span class="fl">100000</span></span>
<span>      <span class="op">)</span></span></code></pre></div>
<p><img src="viirsSST_100000.png"></p>
<p>The increased resolution can really make a difference when the land
masks the grid:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapTitle <span class="op">=</span> <span class="st">"maxpixels = 100,000, landmask"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>      <span class="va">viirsSST</span>, </span>
<span>      <span class="op">~</span><span class="va">sst</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">"thermal"</span>,  </span>
<span>      maxpixels <span class="op">=</span> <span class="fl">100000</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>landmask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="viirsSST_100000_mask.png"></p>
</div>
<div class="section level4">
<h4 id="working-with-other-continental-outlines">Working with other continental outlines<a class="anchor" aria-label="anchor" href="#working-with-other-continental-outlines"></a>
</h4>
<p>My default, <code><a href="../reference/plotdap.html">plotdap()</a></code> uses the global “world” database
from the <code>map</code> package, and then trims the polygons based on
the limit of the map. Higher resolution coastlines or coastlines that
cross the dateline require can be used in <code><a href="../reference/plotdap.html">plotdap()</a></code>by
passing this information in the function call. Similarly, computations
can be sped up by pre-selecting the area of the coastline database
before calling <code><a href="../reference/plotdap.html">plotdap()</a></code>.</p>
<p>To map the VIIRS SST data from the previous section using a
subsetted, high-resolution continental outline, first the subset is
defined for the high-resolution database:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"worldHires"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">130.</span>, <span class="op">-</span><span class="fl">114</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.</span>, <span class="fl">42.</span><span class="op">)</span>, </span>
<span>         fill <span class="op">=</span> <span class="cn">TRUE</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>and then plotted, with the landmask option:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapData <span class="op">=</span> <span class="va">w</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>      <span class="va">viirsSST</span>, </span>
<span>      <span class="op">~</span><span class="va">sst</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">'thermal'</span>,  </span>
<span>      maxpixels <span class="op">=</span> <span class="fl">50000</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>landmask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="viirsSST_100000_mask.png"></p>
<p>The “Simple Ocean Data Assimilation (SODA)” model (see <a href="https://www2.atmos.umd.edu/~ocean/" class="external-link uri">https://www2.atmos.umd.edu/~ocean/</a>) reconstructs the
historical physical history of the ocean since the beginning of the 20th
century. Here is the temperature at 70m depth for December 2015 for the
North Pacific Ocean, as an example of using <code><a href="../reference/plotdap.html">plotdap()</a></code> when
the data cross the dateline:</p>
<p>First, get the SODA data:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">soda70Info</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">'erdSoda331oceanmday'</span><span class="op">)</span></span>
<span><span class="va">xpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">135.25</span>, <span class="fl">240.25</span><span class="op">)</span></span>
<span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20.25</span>, <span class="fl">60.25</span><span class="op">)</span></span>
<span><span class="va">zpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">70.02</span>, <span class="fl">70.02</span><span class="op">)</span></span>
<span><span class="va">tpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2010-12-15'</span>, <span class="st">'2010-12-15'</span><span class="op">)</span></span>
<span><span class="va">soda70</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/griddap.html" class="external-link">griddap</a></span><span class="op">(</span><span class="va">soda70Info</span>,  </span>
<span>                  longitude <span class="op">=</span> <span class="va">xpos</span>, </span>
<span>                  latitude <span class="op">=</span> <span class="va">ypos</span>, </span>
<span>                  time <span class="op">=</span> <span class="va">tpos</span>, </span>
<span>                  depth <span class="op">=</span> <span class="va">zpos</span>, </span>
<span>                  fields <span class="op">=</span> <span class="st">'temp'</span> <span class="op">)</span></span></code></pre></div>
<p>then plot with <code>plotdap</code></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UK:Great Britain"</span>, <span class="st">"France"</span>, <span class="st">"Spain"</span>, <span class="st">"Algeria"</span>, <span class="st">"Mali"</span>, </span>
<span>            <span class="st">"Burkina Faso"</span>, <span class="st">"Ghana"</span>, <span class="st">"Togo"</span><span class="op">)</span></span>
<span><span class="co">#subset world2Hires with those countries removed</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"mapdata::world2Hires"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>         ylim <span class="op">=</span> <span class="va">ypos</span>, xlim <span class="op">=</span> <span class="va">xpos</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"mapdata::world2Hires"</span>, regions <span class="op">=</span> <span class="va">w</span><span class="op">$</span><span class="va">names</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">w</span><span class="op">$</span><span class="va">names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">remove</span><span class="op">)</span><span class="op">]</span>, </span>
<span>         plot <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, ylim <span class="op">=</span> <span class="va">ypos</span>, xlim <span class="op">=</span> <span class="va">xpos</span><span class="op">)</span></span>
<span><span class="co"># plot result</span></span>
<span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapData <span class="op">=</span> <span class="va">w</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>          <span class="va">soda70</span>, </span>
<span>          <span class="op">~</span><span class="va">temp</span>, </span>
<span>          fill <span class="op">=</span> <span class="st">"thermal"</span></span>
<span>          <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>landmask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span></code></pre></div>
<p><img src="soda70.png"></p>
</div>
</div>
<div class="section level3">
<h3 id="combining-tablesgrids">Combining tables/grids<a class="anchor" aria-label="anchor" href="#combining-tablesgrids"></a>
</h3>
<p>The <code><a href="../reference/plotdap.html">plotdap()</a></code> interface is designed so that you can plot
both tables and grids at once (although I don’t recommend trying to plot
more than one <code>griddap()</code> or <code>tabledap()</code> object
at once). It’s also designed to work well with the <code>%&gt;%</code>
operator from the <strong>magrittr</strong> package so that code can be
expressed in a left-to-right (rather than inside-out) fashion:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span>   <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    <span class="va">murSST_west</span>, </span>
<span>    <span class="op">~</span><span class="va">analysed_sst</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"thermal"</span></span>
<span>    <span class="op">)</span> </span>
<span><span class="va">p1</span> <span class="op">&lt;-</span>   <span class="fu"><a href="../reference/add_tabledap.html">add_tabledap</a></span><span class="op">(</span><span class="va">p</span>,</span>
<span>    <span class="va">sardines</span>, </span>
<span>    <span class="op">~</span><span class="va">subsample_count</span></span>
<span>    <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p1</span>, landmask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="overlay.png"></p>
</div>
<div class="section level3">
<h3 id="modifying-ggplotdap-objects">Modifying <code>ggplotdap</code> objects<a class="anchor" aria-label="anchor" href="#modifying-ggplotdap-objects"></a>
</h3>
<p>By this point, you might have noticed some subtle differences in the
defaults of <code>plotdap("ggplot2")</code> versus
<code>plotdap("base")</code>. The default base version is intentionally
left minimal as it is often much harder (or impossible) to modify/remove
elements from a base graphic once it’s drawn. However, this is fairly
easy using the <strong>ggplot2</strong> approach (assuming you know a
bit of <strong>ggplot2</strong>), thanks to the
<code><a href="../reference/add_ggplot.html">add_ggplot()</a></code> function (think of it like the <code>+</code>
operator in <strong>ggplot2</strong>).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=robin"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_tabledap.html">add_tabledap</a></span><span class="op">(</span></span>
<span>    <span class="va">sardines</span>, </span>
<span>    <span class="op">~</span><span class="va">subsample_count</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_ggplot.html">add_ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>      subtitle <span class="op">=</span> <span class="st">"Sardinops sagax samples"</span>,</span>
<span>      caption <span class="op">=</span> <span class="st">"Sardines are yummy"</span></span>
<span>    <span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="using_plotdap_files/figure-html/modify-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Similarly, VIIRS SST plot in the previous section, detail is lost due
to high values observed in landlocked water. To modify that plot:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_color</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="va"><a href="https://docs.ropensci.org/rerddap/reference/colors.html" class="external-link">colors</a></span><span class="op">$</span><span class="va">temperature</span></span>
<span><span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>mapTitle <span class="op">=</span> <span class="st">"Reset colorscale limits"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>      <span class="va">viirsSST</span>, </span>
<span>      <span class="op">~</span><span class="va">sst</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">"thermal"</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_ggplot.html">add_ggplot</a></span><span class="op">(</span></span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">temp_color</span>, na.value <span class="op">=</span> <span class="cn">NA</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_colour_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="va">temp_color</span>, na.value <span class="op">=</span> <span class="cn">NA</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>     <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span>landmask <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="modify2.png"></p>
</div>
<div class="section level3">
<h3 id="animating-plotdap-objects">Animating <code>plotdap</code> objects<a class="anchor" aria-label="anchor" href="#animating-plotdap-objects"></a>
</h3>
<p>Since <code>time</code> is an important variable in many
<code>tabledap()</code> and <code>griddap()</code> objects, both
functions have an <code>animate</code> argument which will animate the
maps over the <code>time</code> variable. The animations only work for
the <code>ggplot2</code> option, and are based on the latest version of
<code>gganimate</code>.</p>
<p><code>gganimate</code> is a very powerful package, and many of the
options available are designed to allow for “tweening”, that is for
smooth animation between frames. Unfortunately for complex maps with
many features, that can lead to very large animations that can take
hours to render. For this reason, all <code>plotdap</code> animations
use <code><a href="https://gganimate.com/reference/transition_manual.html" class="external-link">gganimate::transition_manual</a></code> so that there is one frame
for each time period, and no “tweening” between frames. The animation
can be controlled by saving the animation to an object, and then
displaying the saved object using <code><a href="https://gganimate.com/reference/animate.html" class="external-link">gganimate::animate()</a></code> to
control the display. The</p>
<p>Since <code>time</code> is an important variable in many
<code>tabledap()</code> objects, <code><a href="../reference/add_tabledap.html">add_tabledap()</a></code> also has a
<code>animate</code> argument which allows you to easily animate over
the <code>time</code> variable. It is also easy to alter the color scale
and symbol type via the <code>color</code> and <code>shape</code>
arguments. For details about these arguments, please refer to the
documentation on <code><a href="../reference/add_tabledap.html">help(add_tabledap)</a></code></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/add_tabledap.html">add_tabledap</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=robin"</span><span class="op">)</span>, </span>
<span>  <span class="va">sardines</span>, </span>
<span>  <span class="op">~</span><span class="va">subsample_count</span>, </span>
<span>  color <span class="op">=</span> <span class="st">"dense"</span>, </span>
<span>  shape <span class="op">=</span> <span class="fl">4</span>, </span>
<span>  animate <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="sardines.gif" alt="sardine animation"><div class="figcaption">sardine animation</div>
</div>
<p>If you just want to animate the raw grid values over time (instead of
computing summary statistic(s) for each cell), you can set
<code>time</code> to the <code>identity</code> function, then set
<code>animate = TRUE</code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=robin"</span><span class="op">)</span>, </span>
<span>  <span class="va">wind</span>, <span class="op">~</span><span class="va">y_wind</span>, </span>
<span>  time <span class="op">=</span> <span class="va">identity</span>, </span>
<span>  fill <span class="op">=</span> <span class="st">'delta'</span>,</span>
<span>  animate <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="y_wind.gif" alt="y_wind animation"> The frames per second
and the total number of frames for an animated <code>plotdap</code>
object <code>p</code> can be controlled calling
<code>gganimate::animate(p$ggplot, ...)</code> with the desired other
settings. Unfortunately, the map bounding box set in <code>p</code> may
not be what is desired, because when <code>plotdap</code> prints an
object it calculates a good bounding box for a map, but that is not
stored in the object <code>p</code>. A utility function
<code><a href="../reference/bbox_set.html">bbox_set()</a></code> is included which will add a desired bounding
box.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_griddap.html">add_griddap</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/plotdap.html">plotdap</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="st">"+proj=robin"</span><span class="op">)</span>, </span>
<span>  <span class="va">wind</span>, <span class="op">~</span><span class="va">y_wind</span>, </span>
<span>  time <span class="op">=</span> <span class="va">identity</span>, </span>
<span>  fill <span class="op">=</span> <span class="st">'delta'</span>,</span>
<span>  animate <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span>  <span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">150</span>, <span class="op">-</span><span class="fl">120</span><span class="op">)</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbox_set.html">bbox_set</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">xlim</span>, <span class="va">ylim</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Carson Sievert, Roy Mendelssohn.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
