<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the rerddapXtracto routines • rerddapXtracto</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the rerddapXtracto routines">
<meta property="og:description" content="rerddapXtracto">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rerddapXtracto</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/UsingrerddapXtracto.html">Using the rerddapXtracto routines</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rmendels/rerddapXtracto/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using the rerddapXtracto routines</h1>
                        <h4 data-toc-skip class="author">Roy
Mendelssohn</h4>
            
            <h4 data-toc-skip class="date">2024-01-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rmendels/rerddapXtracto/blob/HEAD/vignettes/UsingrerddapXtracto.Rmd" class="external-link"><code>vignettes/UsingrerddapXtracto.Rmd</code></a></small>
      <div class="hidden name"><code>UsingrerddapXtracto.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>rerddapXtracto</code> is an <span style="color:red">R</span>
package developed to subset and extract satellite and other
oceanographic related data from any <span style="color:red">ERDDAP</span> server using the <span style="color:red">R</span> package <a href="https://cran.r-project.org/package=rerddap" class="external-link">rerddap</a> developed
by Scott Chamberlain and the wonderful people at ‘rOpenSci’. <span style="color:red">ERDDAP</span> is a simple to use yet powerful web data
service developed by Bob Simons. <code>rerddapXtracto</code> extends the
<code>rerddap</code> package by allowing a user to extract data for a
moving point in time along a user-supplied set of longitude, latitude,
depth and time points; and also extracting data within a polygon
(through time).</p>
<p><code>rerddapXtracto</code> version 1.0.0 represented a major rewrite
of the internal workings of <code><a href="../reference/rxtracto.html">rxtracto()</a></code>, which were
invisible to the user but provided for faster execution particularly for
large tracks. Among other improvements. instead of doing an extract for
each point, one extract is done for all points that match to the same
time period in the ERDDAP dataset. For large extracts,this can make a
very large difference in the speed of execution. This also means that
for extracts that do not have a time coordinate, such as bathymetric
data, only one extract will be made from ERDDAP. If the data are of high
enough resolution and the data request covers a large enough area, it is
possible this will exceed the 2GB limit of ERDDAP netCDF files, and the
extract will have to be done in pieces.</p>
<p><code>rerddapXtracto</code> version 1.1.0 and above now allow
<code><a href="../reference/rxtracto.html">rxtracto()</a></code> to use the new “interpolate” service in <span style="color:red">ERDDAP</span>. The “interpolate” service allows for
100 points along the track to be processed at a time, which can greatly
speed-up large extracts. A downside is that “neighbors” are done in
terms of pixels, not coordinate units, so that for high-resolution
datasets the “neighborhood” used to make the interpolation can be quite
small in terms of coordinate units. Presently the dataset must have at
least coordinates of time, latitude and longitude, so that the
interpolate feature will not work with 2-D datasets such as bathymetry
data.</p>
<p>Features that have been added over the course of development include
allowing the z-coordinate to vary in both <code><a href="../reference/rxtracto.html">rxtracto()</a></code> and
<code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code>; plotting functions <code><a href="../reference/plotTrack.html">plotTrack()</a></code>
and <code><a href="../reference/plotBBox.html">plotBBox()</a></code> that can take the output from
<code><a href="../reference/rxtracto.html">rxtracto()</a></code> and <code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code>and produce maps
of the data, including animated maps; the ability to cross the dateline
in a request when the ERDDAP dataset has longitudes in the range (-180,
180); an optional progress bar in <code><a href="../reference/rxtracto.html">rxtracto()</a></code>; and the
return in <code><a href="../reference/rxtracto.html">rxtracto()</a></code> of values extracted so far should the
extract fail partway through the extract; <code><a href="../reference/rxtracto.html">rxtracto()</a></code> ow
works with projected datasets and an example is given below .</p>
<p>Since the z-coordinate is not limited to be at a set location, for
<code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> this means that if the z-coordinate needs to
be given, then it must be of length two. For <code><a href="../reference/rxtracto.html">rxtracto()</a></code> if
the z-coordinate needs to be given it must be of the same length as the
other coordinates, and can also have a “zlen”“, like”xlen” and “ylen”,
that defines a bounding box within which to make the extract. The
advantage of this is it allows <code><a href="../reference/rxtracto.html">rxtracto()</a></code> to make extracts
moving in (x, y, z, t) space.</p>
<p>The plotting function <code><a href="../reference/plotTrack.html">plotTrack()</a></code> for tracks and
<code><a href="../reference/plotBBox.html">plotBBox()</a></code> for grids use the <span style="color:red">R</span> package <code>plotdap</code>, originally
developed for producing maps from data extracted using
<code>rerddap</code>. The plotting functions now allow for user defined
continental outlines (important if crossing the dateline), a user
defined crs, as well as animation. When more control of a plot is
desired, <code>ggplot2</code> (or other map plotting packages) can be
used directly. Several examples in this vignette demonstrate the use of
<code>ggplot2</code>.</p>
<p>Requesting an extract that crosses the dateline for an ERDDAP dataset
that is on a (-180, 180) longitude grid must be done with care. The
requested longitudes must be in the range (0, 360) and several checks
that the request is within the bounds of the dataset are disabled. This
is particularly important when using <code><a href="../reference/rxtracto.html">rxtracto()</a></code>, where the
observed longitude point may not cross the dateline but the bounding box
defined by “xlen” may cross it.</p>
<div class="section level3">
<h3 id="the-main-rerddapxtracto-functions">The Main <code>rerddapXtracto</code> functions<a class="anchor" aria-label="anchor" href="#the-main-rerddapxtracto-functions"></a>
</h3>
<p>There are three main data extraction functions in the
<code>rerddapXtracto</code> package:</p>
<ul>
<li><p><code>rxtracto &lt;- function(dataInfo, parameter = NULL, xcoord = NULL, ycoord = NULL, zcoord = NULL, tcoord = NULL, xlen = 0., ylen = 0., zlen = 0., xName = 'longitude', yName = 'latitude', zName = 'altitude', tName = 'time', interp = NULL, verbose = FALSE,  progress_bar = FALSE)</code></p></li>
<li><p><code>rxtracto_3D &lt;- function(dataInfo, parameter = NULL, xcoord = NULL, ycoord = NULL, zcoord = NULL, tcoord = NULL, xName = 'longitude', yName = 'latitude', zName = 'altitude', tName = 'time', verbose = FALSE, cache_remove = TRUE)</code></p></li>
<li><p><code>rxtractogon &lt;- function(dataInfo, parameter, xcoord = NULL, ycoord = NULL, zcoord = NULL, tcoord = NULL, xName = 'longitude', yName = 'latitude', zName = 'altitude', tName = 'time', verbose = FALSE)</code></p></li>
</ul>
<p>and two functions for producing maps:</p>
<ul>
<li><p><code>plotTrack &lt;- function(resp, xcoord, ycoord, tcoord, plotColor = 'viridis', myFunc = NA, mapData = NULL, crs = NULL, animate = FALSE, cumulative = FALSE, name = NA,  shape = 20, size = .5)</code></p></li>
<li><p><code>plotBBox &lt;- function(resp, plotColor = 'viridis', time = NA, myFunc = NA, mapData = NULL, crs = NULL, animate = FALSE, cumulative = FALSE, name = NA, maxpixels = 10000)</code></p></li>
</ul>
<p>New since version 1.1.6 is a helper function to convert output from
<code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> and <code><a href="../reference/rxtractogon.html">rxtractogon()</a></code> to “tidy”
long-form:</p>
<ul>
<li><code>tidy_grid &lt;- function(response)</code></li>
</ul>
<p>This makes it easier to use the output in packages such as
<code>ggplot2</code>.</p>
<p>The data extraction functions require information about the dataset
obtained by the function <code><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">rerddap::info()</a></code>, and possibly
having to give the names of the coordinate variables, as these can not
be assumed (for example the zcoord could be in sigma coordinates). More
specifically:</p>
<ul>
<li>dataInfo: the return from an <code><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">rerddap::info()</a></code> call to a
dataset on an <span style="color:red">ERDDAP</span> server</li>
<li>parameter: character string containing the name of the parameter to
extract</li>
<li>xName: character string with name of the xcoord in the <span style="color:red">ERDDAP</span> dataset (default “longitude”)</li>
<li>yName: character string with name of the ycoord in the <span style="color:red">ERDDAP</span> dataset (default “latitude”)</li>
<li>zName: character string with name of the zcoord in the <span style="color:red">ERDDAP</span> dataset (default “altitude”)</li>
<li>tName: character string with name of the tcoord in the <span style="color:red">ERDDAP</span> dataset (default “time”)</li>
<li>verbose: logical variable (default FALSE) if the the URL request
should be verbose</li>
</ul>
</div>
<div class="section level3">
<h3 id="time-has-come-today">Time has come today<a class="anchor" aria-label="anchor" href="#time-has-come-today"></a>
</h3>
<p>With all due respect to the ‘Chambers Brothers (their song ’Time Has
Come Today’), since any <span style="color:red">ERDDAP</span> served
gridded data can be accessed, care must be used with the values of
“time” passed to <code>rerddapXtracto</code>. Datasets can have time
increments of less than a day, an example of which is <a href="#hourly">given below</a>. <span style="color:red">ERDDAP</span>
maps all times to “Zulu” time, of the form “2016-11-01T00:00:00Z”. The
date-time “2016-11-01” gets mapped to “2016-11-01T00:00:00Z”. Some <span style="color:red">R</span> date-time functions when the resolution is
finer than a day map the time to the time-zone of the user’s computer.
Be certain that the times you give will be mapped correctly. The
<code>parse_date()</code> function of the <a href="https://cran.r-project.org/package=parsedate" class="external-link">parsedate</a>
package is used to translate date-time strings, if in doubt you can use
that function to see how the times you are passing will be
interpreted.</p>
</div>
</div>
<div class="section level2">
<h2 id="setting-up">Setting up<a class="anchor" aria-label="anchor" href="#setting-up"></a>
</h2>
<p><code>rerddapXtracto</code> uses the <span style="color:red">R</span>
packages <code>ncdf4</code>, <code>parsedate</code>,
<code>plotdap</code>, <code>rerddap</code>, and <code>sp</code>, and
these packages (and the packages imported by these packages) must be
installed first or <code>rerddapXtracto</code> will fail to install.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ncdf4"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"parsedate"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"plotdap"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rerddap"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"sp"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The <code>rerddapXtracto</code> package is available through <span style="color:blue">CRAN</span> and can be installed by:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rerddapXtracto"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The development version of the <code>rerddapXtracto</code> package is
available from <a href="https://github.com/rmendels/rerddapXtracto" class="external-link">Github</a>. To install
the development version,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"rmendels/rerddapXtracto"</span>, subdir <span class="op">=</span> <span class="st">'development'</span><span class="op">)</span></span></code></pre></div>
<p>Note that <code>plotdap</code> depends on a number of packages that
must be installed. These include the packages <code>cmocean</code>,
<code>ggplot2</code>, <code>raster</code> and <code>sf</code>. To use
the animation features, <code>gganimate</code> must be installed.</p>
<p>If the other <span style="color:red">R</span> libraries have been
installed they will be found and do not need to be explicitly
loaded.</p>
<div class="section level3">
<h3 id="using-the-r-code-examples">Using the R code examples<a class="anchor" aria-label="anchor" href="#using-the-r-code-examples"></a>
</h3>
<p>Once installed, to use <code>rerddapXtracto</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/rerddapXtracto" class="external-link">"rerddapXtracto"</a></span><span class="op">)</span></span></code></pre></div>
<p>and to use the plotting functions:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://gganimate.com" class="external-link">"gganimate"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/plotdap" class="external-link">"plotdap"</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>There are some fine points that need to be understood to properly use
the plotting functions, in particular <code><a href="../reference/plotBBox.html">plotBBox()</a></code>. Both
<code><a href="../reference/plotTrack.html">plotTrack()</a></code> and <code><a href="../reference/plotBBox.html">plotBBox()</a></code> rearrange the
output so that the functions <code><a href="https://rdrr.io/pkg/plotdap/man/add_tabledap.html" class="external-link">plotdap::add_tabledap()</a></code> and
<code><a href="https://rdrr.io/pkg/plotdap/man/add_griddap.html" class="external-link">plotdap::add_griddap()</a></code> think that the output is from
<code>rerddap</code>, and then make the appropriate <code>plotdap</code>
call. When the data that are passed to <code><a href="https://rdrr.io/pkg/plotdap/man/add_griddap.html" class="external-link">add_griddap()</a></code> has
multiple time periods, there are two options. The first option is to set
the parameter “time” to a function that reduces the data to one
dimension in the time coordinate (such as the mean), or else to set
“time” equal to “identity” and set “animate” to be “TRUE” which will
produce a time animation of the results. If an animation is requested
and the option “cumulative” is set to be “TRUE”, then the animation will
be cumulative. This is a nice feature for displaying tracks through
time. The function <code><a href="../reference/plotBBox.html">plotBBox()</a></code> works the same way, except
that the default function is <code>mean(na.rm = TRUE)</code>. The
following link to examples that show how to use different features of
the plotting functions:</p>
<ul>
<li><p><a href="#colorPalette">Setting the color palette</a> shows how
to use the “plotColor” option. The “plotColor” parameter can be the name
of any of the colors included in the <code>cmocean</code> package. The
<code>cmocean</code> colormaps were designed by Kristen Thyng (see <a href="https://matplotlib.org/cmocean/" class="external-link uri">https://matplotlib.org/cmocean/</a> and <a href="https://github.com/matplotlib/cmocean" class="external-link uri">https://github.com/matplotlib/cmocean</a>), and were
initially developed for Python)</p></li>
<li><p><a href="#plot1">Plot one time period</a> example shows how to
manipulate an existing output from <code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> or
<code>rextractogon()</code> to plot just one time period.</p></li>
<li><p><a href="#transform">Transform the data</a> example shows how to
use the “myFunc” option to transform the data before plotting. The
function has to be a function of a single argument. This example also
shows how to use the “name” option to change the name displayed on the
color bar. In this example, we want depth to go downwards in the
colorbar, and the name given changed from “altitude”, which is the name
on <span style="color:red">ERDDAP</span>, to the name “Depth”.</p></li>
<li><p><a href="#name">Name</a> example shows how to change the name on
the colorbar.</p></li>
<li><p><a href="#modify">Modify the graph</a> shows how to use the
<code>plotdap</code> function <code><a href="https://rdrr.io/pkg/plotdap/man/add_ggplot.html" class="external-link">add_ggplot()</a></code> to modify a
graph once it has been generated.</p></li>
<li><p><a href="#animateTrack">Animate a track</a> shows how to animate
a track over time.</p></li>
<li><p><a href="#animateGrid">Animate a grid</a> shows how to animate a
grid with multiple time periods.</p></li>
</ul>
<p>The first step is to obtain information about the dataset of interest
from the <span style="color:red">ERDDAP</span> server being used. The
needed information include:</p>
<ul>
<li>baseURL of the <span style="color:red">ERDDAP</span> server (the
default is <a href="https://upwell.pfeg.noaa.gov/erddap" class="external-link uri">https://upwell.pfeg.noaa.gov/erddap</a>)</li>
<li>the datasetID of the data to be accessed (for example the 1-day
composite of chlorophyll from MODIS Aqua has a datasetID of
‘erdMBchla1day’ - see <a href="https://upwell.pfeg.noaa.gov/erddap/griddap/erdMBchla1day.html" class="external-link uri">https://upwell.pfeg.noaa.gov/erddap/griddap/erdMBchla1day.html</a>)</li>
<li>the parameter name (in this case “chlorophyll”)</li>
</ul>
<p>In order for <code>rerddapXtracto</code> to have this information, as
well as the coordinate variables and their limits, and the parameter
names, a call must be made to the function <code><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">rerddap::info()</a></code>
for the appropriate datasetID and baseURL:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/" class="external-link">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="co">## base URL does not need to given because it is the default one</span></span>
<span><span class="va">dataInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">'erdMBchla1day'</span><span class="op">)</span></span>
<span><span class="va">dataInfo</span></span></code></pre></div>
<p>this returns the following information:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="sc">&lt;</span>ERDDAP info<span class="sc">&gt;</span> erdMBchla1day </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a> Base URL<span class="sc">:</span> https<span class="sc">:</span><span class="er">//</span>upwell.pfeg.noaa.gov<span class="sc">/</span>erddap<span class="sc">/</span> </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a> <span class="fu">Dimensions</span> (range)<span class="sc">:</span>  </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>     time<span class="sc">:</span> (<span class="dv">2006-01-01</span>T12<span class="sc">:</span><span class="dv">00</span><span class="sc">:</span><span class="dv">00</span>Z, <span class="dv">2020-10-27</span>T12<span class="sc">:</span><span class="dv">00</span><span class="sc">:</span><span class="dv">00</span>Z) </span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>     altitude<span class="sc">:</span> (<span class="fl">0.0</span>, <span class="fl">0.0</span>) </span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>     latitude<span class="sc">:</span> (<span class="sc">-</span><span class="fl">45.0</span>, <span class="fl">65.0</span>) </span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>     longitude<span class="sc">:</span> (<span class="fl">120.0</span>, <span class="fl">320.0</span>) </span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a> Variables<span class="sc">:</span>  </span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>     chlorophyll<span class="sc">:</span> </span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>         Units<span class="sc">:</span> mg m<span class="dv">-3</span></span></code></pre></div>
<div class="section level3">
<h3 id="an-rxtracto-example">An <code>rxtracto</code> example<a class="anchor" aria-label="anchor" href="#an-rxtracto-example"></a>
</h3>
<p>In this section data is extracted along a trackline found in the
<span style="color:red">Marlintag38606</span> dataset, which is the
track of a tagged marlin in the Pacific Ocean (courtesy of Dr. Mike
Musyl of the Pelagic Research Group LLC), and then simple plots of the
extracted data are made. Since this can be a long extract, a progress
bar is displayed:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/" class="external-link">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/rerddapXtracto" class="external-link">"rerddapXtracto"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># First we will copy the Marlintag38606 data into a variable </span></span>
<span><span class="co"># called tagData  so that subsequent code will be more generic.  </span></span>
<span></span>
<span><span class="va">tagData</span> <span class="op">&lt;-</span> <span class="va">Marlintag38606</span></span>
<span><span class="va">xpos</span> <span class="op">&lt;-</span> <span class="va">tagData</span><span class="op">$</span><span class="va">lon</span></span>
<span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="va">tagData</span><span class="op">$</span><span class="va">lat</span></span>
<span><span class="va">tpos</span> <span class="op">&lt;-</span> <span class="va">tagData</span><span class="op">$</span><span class="va">date</span></span>
<span><span class="va">zpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">xpos</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">swchlInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">'erdSWchla8day'</span><span class="op">)</span></span>
<span><span class="va">swchl1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxtracto.html">rxtracto</a></span><span class="op">(</span><span class="va">swchlInfo</span>, parameter <span class="op">=</span> <span class="st">'chlorophyll'</span>, </span>
<span>                   xcoord <span class="op">=</span> <span class="va">xpos</span>, ycoord <span class="op">=</span> <span class="va">ypos</span>, tcoord <span class="op">=</span> <span class="va">tpos</span>, zcoord <span class="op">=</span> <span class="va">zpos</span>, </span>
<span>                   xlen <span class="op">=</span> <span class="fl">.2</span>, ylen <span class="op">=</span> <span class="fl">.2</span>, progress_bar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plotting-the-results">Plotting the results<a class="anchor" aria-label="anchor" href="#plotting-the-results"></a>
</h3>
<p>The track line with the locations colored according to the mean of
the satellite <code>chlorophyll</code> around that point can be plotted
using <code><a href="../reference/plotTrack.html">plotTrack()</a></code>. Positions where there was a tag location
but no <code>chlorophyll</code> values are also shown. This example
shows the use of the “plotColor” parameter to use the
<code>cmocean</code> “algae” color palette.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/plotdap" class="external-link">"plotdap"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">myPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotTrack.html">plotTrack</a></span><span class="op">(</span><span class="va">swchl1</span>, <span class="va">xpos</span>, <span class="va">ypos</span>, <span class="va">tpos</span>, plotColor <span class="op">=</span> <span class="st">'algae'</span><span class="op">)</span></span>
<span><span class="va">myPlot</span></span></code></pre></div>
<p><img src="swchl.png"></p>
</div>
<div class="section level3">
<h3 id="animating-the-track">Animating the track<a class="anchor" aria-label="anchor" href="#animating-the-track"></a>
</h3>
<p>To make a cumulative animation of the track:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotTrack.html">plotTrack</a></span><span class="op">(</span><span class="va">swchl1</span>, <span class="va">xpos</span>, <span class="va">ypos</span>, <span class="va">tpos</span>, plotColor <span class="op">=</span> <span class="st">'algae'</span>,</span>
<span>                    animate <span class="op">=</span> <span class="cn">TRUE</span>, cumulative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="chla.gif" alt="marlin Track Animation"><div class="figcaption">marlin Track Animation</div>
</div>
<p>Output from <code><a href="../reference/rxtracto.html">rxtracto()</a></code> can readily be converted to a
form for use in the “tidyverse” by converting the output to a dataframe,
to wit:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">swchl1_tidy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">swchl1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="topography-data">Topography data<a class="anchor" aria-label="anchor" href="#topography-data"></a>
</h3>
<p>This example demonstrates how to pass a function to
<code><a href="../reference/plotTrack.html">plotTrack()</a></code> to transform the data before plotting, how to
change the name shown on the colorbar, and how to call
<code><a href="../reference/plotTrack.html">plotTrack()</a></code> if the dataset does not have a time
coordinate.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/plotdap" class="external-link">"plotdap"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/" class="external-link">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/rerddapXtracto" class="external-link">"rerddapXtracto"</a></span><span class="op">)</span></span>
<span><span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">160</span>, <span class="op">-</span><span class="fl">105</span><span class="op">)</span></span>
<span><span class="va">topoInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">'etopo360'</span><span class="op">)</span></span>
<span><span class="va">topo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxtracto.html">rxtracto</a></span><span class="op">(</span><span class="va">topoInfo</span>, parameter <span class="op">=</span> <span class="st">'altitude'</span>, xcoord <span class="op">=</span> <span class="va">xpos</span>, ycoord <span class="op">=</span> <span class="va">ypos</span>, xlen <span class="op">=</span> <span class="fl">.1</span>, ylen <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span></span>
<span><span class="va">myFunc</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span><span class="va">x</span></span>
<span><span class="va">topoPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotTrack.html">plotTrack</a></span><span class="op">(</span><span class="va">topo</span>, <span class="va">xpos</span>, <span class="va">ypos</span>, <span class="cn">NA</span>, plotColor <span class="op">=</span> <span class="st">'dense'</span>, </span>
<span>                      name <span class="op">=</span> <span class="st">'Depth'</span>, myFunc <span class="op">=</span> <span class="va">myFunc</span><span class="op">)</span></span>
<span><span class="va">topoPlot</span></span></code></pre></div>
<p><img src="topo.png"></p>
</div>
<div class="section level3">
<h3 id="track-moving-in-x-y-z-t-space-">Track moving in (x, y, z, t) space.<a class="anchor" aria-label="anchor" href="#track-moving-in-x-y-z-t-space-"></a>
</h3>
<p>The following is an artificial example showing a track moving in (x,
y, z, t) space. Since the times of the model output change, the actual
times are retrieved, and the last three times used in the example.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/" class="external-link">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">urlBase</span> <span class="op">&lt;-</span> <span class="st">"https://erddap.marine.ie/erddap/"</span></span>
<span><span class="va">parameter</span> <span class="op">&lt;-</span> <span class="st">"Sea_water_temperature"</span></span>
<span><span class="va">dataInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">"IMI_CONN_3D"</span>, url <span class="op">=</span> <span class="va">urlBase</span><span class="op">)</span></span>
<span><span class="co">#get the actual last 3 times,  and extract from data frame</span></span>
<span><span class="va">dataInfo1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://erddap.marine.ie/erddap/griddap/IMI_CONN_3D.csv0?time[last-2:1:last]"</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span>, header <span class="op">=</span> <span class="cn">FALSE</span>, row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">sstTimes</span> <span class="op">&lt;-</span> <span class="va">dataInfo1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">sstLats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">53.505758092414446</span>, <span class="fl">53.509303546859805</span>, <span class="fl">53.51284900130517</span><span class="op">)</span></span>
<span><span class="va">sstLons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10.25975390624996</span>, <span class="op">-</span><span class="fl">10.247847656249961</span>, <span class="op">-</span><span class="fl">10.23594140624996</span><span class="op">)</span></span>
<span><span class="va">sstDepths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">sstTrack</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxtracto.html">rxtracto</a></span><span class="op">(</span><span class="va">dataInfo</span>, parameter <span class="op">=</span> <span class="va">parameter</span>, xcoord <span class="op">=</span> <span class="va">sstLons</span>, ycoord <span class="op">=</span> <span class="va">sstLats</span>, tcoord <span class="op">=</span> <span class="va">sstTimes</span>, zcoord <span class="op">=</span> <span class="va">sstDepths</span>, xlen <span class="op">=</span> <span class="fl">.05</span>, ylen <span class="op">=</span> <span class="fl">.05</span>, zlen <span class="op">=</span> <span class="fl">0.</span>, zName <span class="op">=</span> <span class="st">'altitude'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sstTrack</span><span class="op">)</span></span></code></pre></div>
<p>This returns the following structure information:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>List of <span class="dv">13</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a> <span class="sc">$</span> mean Sea_water_temperature  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="fl">11.7</span> <span class="fl">11.7</span> <span class="fl">11.6</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a> <span class="sc">$</span> stdev Sea_water_temperature <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="fl">0.0407</span> <span class="fl">0.0555</span> <span class="fl">0.0859</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a> <span class="sc">$</span> n                           <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="dv">493</span> <span class="dv">491</span> <span class="dv">484</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a> <span class="sc">$</span> satellite date              <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="st">"2020-10-31T22:00:00Z"</span> <span class="st">"2020-10-31T23:00:00Z"</span> <span class="st">"2020-11-01T00:00:00Z"</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a> <span class="sc">$</span> requested lon min           <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="sc">-</span><span class="fl">10.3</span> <span class="sc">-</span><span class="fl">10.3</span> <span class="sc">-</span><span class="fl">10.3</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a> <span class="sc">$</span> requested lon max           <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="sc">-</span><span class="fl">10.2</span> <span class="sc">-</span><span class="fl">10.2</span> <span class="sc">-</span><span class="fl">10.2</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a> <span class="sc">$</span> requested lat min           <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="fl">53.5</span> <span class="fl">53.5</span> <span class="fl">53.5</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a> <span class="sc">$</span> requested lat max           <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="fl">53.5</span> <span class="fl">53.5</span> <span class="fl">53.5</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a> <span class="sc">$</span> requested z min             <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="dv">2</span> <span class="dv">6</span> <span class="dv">10</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a> <span class="sc">$</span> requested z max             <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="dv">2</span> <span class="dv">6</span> <span class="dv">10</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a> <span class="sc">$</span> requested date              <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="st">"2020-10-31T22:00:00Z"</span> <span class="st">"2020-10-31T23:00:00Z"</span> <span class="st">"2020-11-01T00:00:00Z"</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a> <span class="sc">$</span> median Sea_water_temperature<span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="fl">11.7</span> <span class="fl">11.7</span> <span class="fl">11.6</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a> <span class="sc">$</span> mad Sea_water_temperature   <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="fl">0.0208</span> <span class="fl">0.0361</span> <span class="fl">0.0986</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a> <span class="sc">-</span> <span class="fu">attr</span>(<span class="sc">*</span>, <span class="st">"row.names"</span>)<span class="ot">=</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="st">"1"</span> <span class="st">"2"</span> <span class="st">"3"</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a> <span class="sc">-</span> <span class="fu">attr</span>(<span class="sc">*</span>, <span class="st">"class"</span>)<span class="ot">=</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="st">"list"</span> <span class="st">"rxtractoTrack"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="crossing-the-dateline">Crossing the dateline<a class="anchor" aria-label="anchor" href="#crossing-the-dateline"></a>
</h3>
<p>The following is an artificial example of a track that crosses the
date-line, using the MUR(Multi-scale Ultra-high Resolution) SST
analysis:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">'jplMURSST41mday'</span><span class="op">)</span></span>
<span><span class="va">parameter</span> <span class="op">&lt;-</span> <span class="st">'sst'</span></span>
<span><span class="va">xcoord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">179.7</span>, <span class="fl">179.8</span>, <span class="fl">179.9</span>, <span class="fl">180.</span>, <span class="fl">180.1</span>, <span class="fl">180.2</span>, <span class="fl">180.3</span>, <span class="fl">180.4</span><span class="op">)</span></span>
<span><span class="va">ycoord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">40</span><span class="op">)</span></span>
<span><span class="va">tcoord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2018-03-16'</span>, <span class="st">'2018-03-16'</span>, <span class="st">'2018-03-16'</span>,<span class="st">'2018-03-16'</span>,<span class="st">'2018-03-16'</span>,</span>
<span>            <span class="st">'2018-03-16'</span>,<span class="st">'2018-03-16'</span>,<span class="st">'2018-03-16'</span><span class="op">)</span></span>
<span><span class="va">xlen</span> <span class="op">&lt;-</span> <span class="fl">.05</span></span>
<span><span class="va">ylen</span> <span class="op">&lt;-</span> <span class="fl">.05</span></span>
<span><span class="va">extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxtracto.html">rxtracto</a></span><span class="op">(</span><span class="va">dataInfo</span>, parameter <span class="op">=</span> <span class="va">parameter</span>, xcoord <span class="op">=</span> <span class="va">xcoord</span>,</span>
<span>                    ycoord <span class="op">=</span> <span class="va">ycoord</span>, tcoord <span class="op">=</span> <span class="va">tcoord</span>,</span>
<span>                    xlen <span class="op">=</span> <span class="va">xlen</span>, ylen <span class="op">=</span> <span class="va">ylen</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">extract</span><span class="op">)</span></span></code></pre></div>
<p>The returned structure is:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>List of <span class="dv">13</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a> <span class="sc">$</span> mean sst         <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="fl">11.1</span> <span class="fl">11.1</span> <span class="fl">11.1</span> <span class="fl">11.2</span> <span class="fl">11.1</span> ...</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a> <span class="sc">$</span> stdev sst        <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="fl">0.01192</span> <span class="fl">0.00602</span> <span class="fl">0.01025</span> <span class="fl">0.00876</span> <span class="fl">0.01446</span> ...</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a> <span class="sc">$</span> n                <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="dv">30</span> <span class="dv">30</span> <span class="dv">35</span> <span class="dv">25</span> <span class="dv">30</span> <span class="dv">30</span> <span class="dv">30</span> <span class="dv">35</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a> <span class="sc">$</span> satellite date   <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="st">"2018-03-16T00:00:00Z"</span> <span class="st">"2018-03-16T00:00:00Z"</span> <span class="st">"2018-03-16T00:00:00Z"</span> <span class="st">"2018-03-16T00:00:00Z"</span> ...</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a> <span class="sc">$</span> requested lon min<span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="dv">180</span> <span class="dv">180</span> <span class="dv">180</span> <span class="dv">180</span> <span class="dv">180</span> ...</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a> <span class="sc">$</span> requested lon max<span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="dv">180</span> <span class="dv">180</span> <span class="dv">180</span> <span class="dv">180</span> <span class="dv">180</span> ...</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a> <span class="sc">$</span> requested lat min<span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> ...</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a> <span class="sc">$</span> requested lat max<span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> ...</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a> <span class="sc">$</span> requested z min  <span class="sc">:</span> logi [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> ...</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a> <span class="sc">$</span> requested z max  <span class="sc">:</span> logi [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> ...</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a> <span class="sc">$</span> requested date   <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="st">"2018-03-16"</span> <span class="st">"2018-03-16"</span> <span class="st">"2018-03-16"</span> <span class="st">"2018-03-16"</span> ...</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a> <span class="sc">$</span> median sst       <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="fl">11.1</span> <span class="fl">11.1</span> <span class="fl">11.1</span> <span class="fl">11.2</span> <span class="fl">11.1</span> ...</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a> <span class="sc">$</span> mad sst          <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="fl">0.01416</span> <span class="fl">0.0052</span> <span class="fl">0.01149</span> <span class="fl">0.00887</span> <span class="fl">0.01744</span> ...</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a> <span class="sc">-</span> <span class="fu">attr</span>(<span class="sc">*</span>, <span class="st">"row.names"</span>)<span class="ot">=</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="st">"1"</span> <span class="st">"2"</span> <span class="st">"3"</span> <span class="st">"4"</span> ...</span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a> <span class="sc">-</span> <span class="fu">attr</span>(<span class="sc">*</span>, <span class="st">"class"</span>)<span class="ot">=</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="st">"list"</span> <span class="st">"rxtractoTrack"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="erddap-interpolate-service">
<span style="color:red">ERDDAP</span> Interpolate service<a class="anchor" aria-label="anchor" href="#erddap-interpolate-service"></a>
</h3>
<p><span style="color:red">ERDDAP</span> has a new “Interpolate” service
which takes a table of coordinate values from a gridded dataset, up to
100 entries at a time, and will interpolate the value at each point
based on quite a large list of different interpolation methods, as well
as the number of neighbors to use in the interpolation (see <a href="https://coastwatch.pfeg.noaa.gov/erddap/convert/interpolate.html" class="external-link uri">https://coastwatch.pfeg.noaa.gov/erddap/convert/interpolate.html</a>.
As the “Interpolate” service includes the mean, median and standard
deviation of the neighboring points, the service can return similar
results as does the usual <code><a href="../reference/rxtracto.html">rxtracto()</a></code> but much more quickly,
as 100 observations are processed at a time. This greatly reduces the
time it takes to process very large tracks. A downside is that neighbors
are defined in terms of pixels, not in terms of coordinate units as is
used in the usual <code><a href="../reference/rxtracto.html">rxtracto()</a></code> call. For very high-resolution
datasets even the largest number of neighbors provided by the service
may not be large enough to capture the uncertainty in the actual
location of an observation in the track.</p>
<p>The “Interpolate” service requires that the <span style="color:red">ERDDAP</span> server being accessed is at least
version 2.10. As of this writing, the default <span style="color:red">ERDDAP</span> in <code>rerddap</code> is at <a href="https://upwell.pfeg.noaa.gov/erddap" class="external-link uri">https://upwell.pfeg.noaa.gov/erddap</a>, which is not.
Therefore, as in the example below, you need to make certain of the
version of <span style="color:red">ERDDAP</span> used in the call to
<code>rerddap:info()</code>.</p>
<p>The “interpolate” option is implemented in a new, optional argument
to <code><a href="../reference/rxtracto.html">rxtracto()</a></code>, “interp = NULL”. Since the argument is
optional, and has a default value of “NULL”, existing calls to
<code><a href="../reference/rxtracto.html">rxtracto()</a></code> will not be affected by the change. To use the
interpolation option, “interp” must be a set equal to a character array
of size 2, that is</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'interpolation method'</span>, <span class="st">'number of neighbors'</span><span class="op">)</span></span></code></pre></div>
<p>For example, to use the ‘Mean’ function with 16 neighbors this would
be:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Mean'</span>,  <span class="st">'16'</span><span class="op">)</span></span></code></pre></div>
<p>Note carefully that “Mean” is capitalized, and that the number of
neighbors is passed as a character string, not as a number. Also the
values of “xlen”, “ylen”, and “zlen”, if given, are ignored. So to use
the “interp” option in the first Marlin example, the call would be:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_interp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Mean'</span>,  <span class="st">'16'</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  use the coastwatch ERDDAP as it is a more recent version</span></span>
<span><span class="co">#</span></span>
<span><span class="va">swchlInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">'erdSWchla8day'</span>, </span>
<span>             url <span class="op">=</span> <span class="st">'https://coastwatch.pfeg.noaa.gov/erddap/'</span><span class="op">)</span></span>
<span><span class="va">swchl1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxtracto.html">rxtracto</a></span><span class="op">(</span><span class="va">swchlInfo</span>, parameter <span class="op">=</span> <span class="st">'chlorophyll'</span>, </span>
<span>                   xcoord <span class="op">=</span> <span class="va">xpos</span>, ycoord <span class="op">=</span> <span class="va">ypos</span>, tcoord <span class="op">=</span> <span class="va">tpos</span>, zcoord <span class="op">=</span> <span class="va">zpos</span>,</span>
<span>                   interp <span class="op">=</span> <span class="va">my_interp</span>, progress_bar <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tracks-along-projected-data-and-polar-bears">Tracks along projected data and Polar Bears<a class="anchor" aria-label="anchor" href="#tracks-along-projected-data-and-polar-bears"></a>
</h3>
<p><code><a href="../reference/rxtracto.html">rxtracto()</a></code> can now extract tracks from projected <span style="color:red">ERDDAP</span> datasets if the proper data
transformations are done first. Here we cover one possible way of
transforming the data in order to work with <code><a href="../reference/rxtracto.html">rxtracto()</a></code> by
extracting sea ice concentration along a polar bear track. The polar
bear track is in the included ‘PB_Argos’ dataset, which is described in
the paper “Auger-Méthé, M., Newman, K., Cole, D., Empacher, F., Gryba,
R., King, A. A., Leos-Barajas, V., Mills Flemming, J., Nielsen, A.,
Petris, G., and Thomas, L.. 2021. A guide to state–space modeling of
ecological time series. Ecological Monographs 91(4):e01470.
10.1002/ecm.1470” and is used by permission of the authors. The dataset
was obtained from <a href="https://datadryad.org/stash/dataset/doi:10.5061/dryad.4qrfj6q96" class="external-link uri">https://datadryad.org/stash/dataset/doi:10.5061/dryad.4qrfj6q96</a>.</p>
<p>One caveat is that while the vector parameters “xlen”, “ylen” and
“zlen” can still be used with projected data, to be sensible these
values must also be in projected units, and for many projections in
order to have a consistent box the values will have to vary with each
latitude-longitude pair. With the present version of
<code><a href="../reference/rxtracto.html">rxtracto()</a></code> it is up to the user to make this calculation,
though the steps below should provide some idea of how to do so. In the
example, “xlen”, “ylen” are zero.</p>
<p>Given a “track” with latitude and longitude values and a projected
dataset, the following steps are necessary:</p>
<ul>
<li><p>Determine the projection used in the <span style="color:red">ERDDAP</span> dataset.</p></li>
<li><p>Transform the latitudes and longitudes into this
projection.</p></li>
<li><p>Make the extract</p></li>
<li><p>If desired, transform the projected coordinates back into
latitude and longitude.</p></li>
</ul>
<p>The dataset to be used is sea ice concentration from the
NOAA/National Snow and Ice Data Center availabe from the Polarwatch
<span style="color:red">ERDDAP</span> at <a href="https://polarwatch.noaa.gov/erddap/griddap/nsidcG02202v4nh1day.html" class="external-link uri">https://polarwatch.noaa.gov/erddap/griddap/nsidcG02202v4nh1day.html</a>
.</p>
<p>The first step is to extract the first 100 datapoints from the
PB_Argos dataset.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>PB_Argos_subset <span class="ot">&lt;-</span> PB_Argos[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, ]</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co"># datetime is not in format for ERDDAP</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>PB_Argos_subset<span class="sc">$</span>DateTime <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">as_datetime</span>(PB_Argos_subset<span class="sc">$</span>DateTime)</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="fu">head</span>(PB_Argos_subset, <span class="dv">4</span>)</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co"># A tibble: 4 × 4</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  DateTime            QualClass   Lat   Lon</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>  <span class="sc">&lt;</span>dttm<span class="sc">&gt;</span>              <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="dv">1</span> <span class="dv">2009-04-20</span> <span class="dv">17</span><span class="sc">:</span><span class="dv">01</span><span class="sc">:</span><span class="dv">39</span> B          <span class="fl">70.4</span> <span class="sc">-</span><span class="fl">132.</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="dv">2</span> <span class="dv">2009-04-20</span> <span class="dv">17</span><span class="sc">:</span><span class="dv">23</span><span class="sc">:</span><span class="dv">00</span> A          <span class="fl">71.0</span> <span class="sc">-</span><span class="fl">131.</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="dv">3</span> <span class="dv">2009-04-20</span> <span class="dv">18</span><span class="sc">:</span><span class="dv">12</span><span class="sc">:</span><span class="dv">15</span> A          <span class="fl">71.0</span> <span class="sc">-</span><span class="fl">131.</span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="dv">4</span> <span class="dv">2009-04-20</span> <span class="dv">20</span><span class="sc">:</span><span class="dv">43</span><span class="sc">:</span><span class="dv">17</span> A          <span class="fl">70.9</span> <span class="sc">-</span><span class="fl">131.</span></span></code></pre></div>
<p>The dataset info can be used to find the dataset projection (note
this uses EPSG codes for the CRS, which can be found at <a href="https://spatialreference.org/ref/epsg/" class="external-link uri">https://spatialreference.org/ref/epsg/</a>):</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>url<span class="ot">=</span>  <span class="st">'https://polarwatch.noaa.gov/erddap/'</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>datasetid <span class="ot">=</span> <span class="st">'nsidcG02202v4nh1day'</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>dataInfo <span class="ot">&lt;-</span> rerddap<span class="sc">::</span><span class="fu">info</span>(datasetid, url)</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>proj_crs_code_index <span class="ot">&lt;-</span> <span class="fu">which</span>(dataInfo<span class="sc">$</span>alldata<span class="sc">$</span>NC_GLOBAL<span class="sc">$</span>attribute_name <span class="sc">==</span> <span class="st">"proj_crs_code"</span> )</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>proj_crs_code <span class="ot">&lt;-</span> dataInfo<span class="sc">$</span>alldata<span class="sc">$</span>NC_GLOBAL<span class="sc">$</span>value[proj_crs_code_index]</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>proj_crs_code</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"EPSG:3411"</span></span></code></pre></div>
<p>Next we will create a temporary dataframe with the latitude and
longitude values, convert that dataframe to an ‘sf’ object, and then
transform the coordinates:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Lat <span class="op">=</span> <span class="va">PB_Argos_subset</span><span class="op">$</span><span class="va">Lat</span>, Lon <span class="op">=</span> <span class="va">PB_Argos_subset</span><span class="op">$</span><span class="va">Lon</span><span class="op">)</span></span>
<span><span class="co"># transform PB_Argos_subset to sf object</span></span>
<span><span class="co"># EPSG:4326 is basic lat-lon coordinates</span></span>
<span><span class="va">temp_df</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">temp_df</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lon"</span>, <span class="st">"Lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="co"># project data </span></span>
<span><span class="va">temp_df</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">temp_df</span>, crs <span class="op">=</span> <span class="fl">3411</span><span class="op">)</span></span>
<span><span class="co"># get projection coordinates</span></span>
<span><span class="va">coordinates</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">temp_df</span><span class="op">)</span></span></code></pre></div>
<p>Now things are set to perform the extract:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>xcoord <span class="ot">&lt;-</span> coordinates[, <span class="dv">1</span>]</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>ycoord <span class="ot">&lt;-</span> coordinates[, <span class="dv">2</span>]</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="co"># R datetimes are passed as number,  require ISO character string</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>tcoord <span class="ot">&lt;-</span> <span class="fu">as.character</span>(PB_Argos_subset<span class="sc">$</span>DateTime)</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>parameter <span class="ot">&lt;-</span> <span class="st">'cdr_seaice_conc'</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>extract <span class="ot">&lt;-</span> <span class="fu">rxtracto</span>(dataInfo,</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>                    <span class="at">xName=</span><span class="st">"xgrid"</span>,</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>                    <span class="at">yName=</span><span class="st">"ygrid"</span>,</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>                    <span class="at">tName=</span><span class="st">"time"</span>,</span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>                    <span class="at">parameter=</span>parameter,</span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a>                    <span class="at">xcoord =</span> xcoord,</span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>                    <span class="at">ycoord =</span> ycoord,</span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>                    <span class="at">tcoord =</span> tcoord</span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a>                    )</span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="fu">str</span>(extract)</span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a>List of <span class="dv">13</span></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a> <span class="sc">$</span> mean cdr_seaice_conc  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a> <span class="sc">$</span> stdev cdr_seaice_conc <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> ...</span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a> <span class="sc">$</span> n                     <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a> <span class="sc">$</span> satellite date        <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="st">"2009-04-21T00:00:00Z"</span> <span class="st">"2009-04-21T00:00:00Z"</span> <span class="st">"2009-04-21T00:00:00Z"</span> <span class="st">"2009-04-21T00:00:00Z"</span> ...</span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a> <span class="sc">$</span> requested x min       <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="sc">-</span><span class="dv">2143958</span> <span class="sc">-</span><span class="dv">2077605</span> <span class="sc">-</span><span class="dv">2077124</span> <span class="sc">-</span><span class="dv">2082576</span> <span class="sc">-</span><span class="dv">2036149</span> ...</span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a> <span class="sc">$</span> requested x max       <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="sc">-</span><span class="dv">2143958</span> <span class="sc">-</span><span class="dv">2077605</span> <span class="sc">-</span><span class="dv">2077124</span> <span class="sc">-</span><span class="dv">2082576</span> <span class="sc">-</span><span class="dv">2036149</span> ...</span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a> <span class="sc">$</span> requested y min       <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="sc">-</span><span class="dv">118477</span> <span class="sc">-</span><span class="dv">131404</span> <span class="sc">-</span><span class="dv">131955</span> <span class="sc">-</span><span class="dv">130368</span> <span class="sc">-</span><span class="dv">120720</span> ...</span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a> <span class="sc">$</span> requested y max       <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="sc">-</span><span class="dv">118477</span> <span class="sc">-</span><span class="dv">131404</span> <span class="sc">-</span><span class="dv">131955</span> <span class="sc">-</span><span class="dv">130368</span> <span class="sc">-</span><span class="dv">120720</span> ...</span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a> <span class="sc">$</span> requested z min       <span class="sc">:</span> logi [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> ...</span>
<span id="cb23-26"><a href="#cb23-26" tabindex="-1"></a> <span class="sc">$</span> requested z max       <span class="sc">:</span> logi [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> ...</span>
<span id="cb23-27"><a href="#cb23-27" tabindex="-1"></a> <span class="sc">$</span> requested date        <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="st">"2009-04-20 17:01:39"</span> <span class="st">"2009-04-20 17:23:00"</span> <span class="st">"2009-04-20 18:12:15"</span> <span class="st">"2009-04-20 20:43:17"</span> ...</span>
<span id="cb23-28"><a href="#cb23-28" tabindex="-1"></a> <span class="sc">$</span> median cdr_seaice_conc<span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb23-29"><a href="#cb23-29" tabindex="-1"></a> <span class="sc">$</span> mad cdr_seaice_conc   <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb23-30"><a href="#cb23-30" tabindex="-1"></a> <span class="sc">-</span> <span class="fu">attr</span>(<span class="sc">*</span>, <span class="st">"row.names"</span>)<span class="ot">=</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>] <span class="st">"1"</span> <span class="st">"2"</span> <span class="st">"3"</span> <span class="st">"4"</span> ...</span>
<span id="cb23-31"><a href="#cb23-31" tabindex="-1"></a> <span class="sc">-</span> <span class="fu">attr</span>(<span class="sc">*</span>, <span class="st">"class"</span>)<span class="ot">=</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="st">"list"</span> <span class="st">"rxtractoTrack"</span></span></code></pre></div>
<p>Since a given location may not fall on a gridpoint of the dataset and
extracts are performed at the nearest grid point, the locations of the
extract in terms of latitude and longitude can be obtained by reversing
the steps above:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xgrid</span> <span class="op">&lt;-</span> <span class="st">'requested x min'</span></span>
<span><span class="va">ygrid</span> <span class="op">&lt;-</span> <span class="st">'requested y min'</span></span>
<span><span class="va">temp_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>xgrid <span class="op">=</span> <span class="va">extract</span><span class="op">[[</span><span class="va">xgrid</span><span class="op">]</span><span class="op">]</span>, ygrid <span class="op">=</span> <span class="va">extract</span><span class="op">[[</span><span class="va">ygrid</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">temp_df</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">temp_df</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"xgrid"</span>, <span class="st">"ygrid"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">3411</span><span class="op">)</span></span>
<span><span class="va">temp_df</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">temp_df</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">coordinates</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">temp_df</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="using-rxtracto_3d">Using <code>rxtracto_3D</code><a class="anchor" aria-label="anchor" href="#using-rxtracto_3d"></a>
</h2>
<p>The function <code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> adds no new capabilities to
<code>rerddap</code>, but returns the data as an array, rather than
“melted” as does <code><a href="https://docs.ropensci.org/rerddap/reference/griddap.html" class="external-link">rerddap::griddap()</a></code>.
<code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> also is used in the function
<code><a href="../reference/rxtractogon.html">rxtractogon()</a></code>, so is provided for consistency.
<code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> also changes latitudes and longitudes to
agree with those of the source <span style="color:red">ERDDAP</span>
dataset, and returns a structure where these are mapped back to the
request.</p>
<div class="section level3">
<h3 id="obtaining-viirs-chlorophyll-data">Obtaining VIIRS chlorophyll data<a class="anchor" aria-label="anchor" href="#obtaining-viirs-chlorophyll-data"></a>
</h3>
<p>We examine VIIRS chlorophyll for the “latest” data as of when the
vignette was generated:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/" class="external-link">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/rerddapXtracto" class="external-link">"rerddapXtracto"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">xpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">125</span>, <span class="op">-</span><span class="fl">120</span><span class="op">)</span> </span>
<span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">39</span>, <span class="fl">36</span><span class="op">)</span></span>
<span><span class="va">tpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"last"</span>, <span class="st">"last"</span><span class="op">)</span></span>
<span><span class="va">tpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2017-04-15"</span>, <span class="st">"2017-04-15"</span><span class="op">)</span></span>
<span><span class="va">VIIRSInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">'erdVH3chlamday'</span><span class="op">)</span></span>
<span><span class="va">VIIRS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxtracto_3D.html">rxtracto_3D</a></span><span class="op">(</span><span class="va">VIIRSInfo</span>, parameter <span class="op">=</span> <span class="st">'chla'</span>, xcoord <span class="op">=</span> <span class="va">xpos</span>, ycoord <span class="op">=</span> <span class="va">ypos</span>, tcoord <span class="op">=</span> <span class="va">tpos</span><span class="op">)</span></span></code></pre></div>
<p><code>rxtracto_3d()</code> returns a list of the form:</p>
<ul>
<li>VIIRS$chla : num [xcoord, ycoord, tcoord]</li>
<li>VIIRS$datasetname: character string of the ERDDAP dataset ID</li>
<li>VIIRS$longitude : num [xcoord] longitude of extract</li>
<li>VIIRS$latitude : num [ycoord] latitudes of extract</li>
<li>VIIRS$altitude : num zcoord of extract</li>
<li>VIIRS$time : POSIXlt[tcoord] times of extract</li>
</ul>
<p>The coordinate names of the structure are based on the names given in
the <code>rxtracto_3d()</code> call, so may differ between datasets.</p>
<p>The extracted data can be mapped using <code><a href="../reference/plotBBox.html">plotBBox()</a></code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/plotdap" class="external-link">"plotdap"</a></span><span class="op">)</span></span>
<span><span class="va">myFunc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">chlalogPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotBBox.html">plotBBox</a></span><span class="op">(</span><span class="va">VIIRS</span>, plotColor <span class="op">=</span> <span class="st">'algae'</span>, myFunc <span class="op">=</span> <span class="va">myFunc</span><span class="op">)</span></span>
<span><span class="va">chlalogPlot</span></span></code></pre></div>
<p><img src="VIIRS_chl.png"></p>
<p>To convert the output to “tidy” long-form:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VIIRS_tidy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tidy_grid.html">tidy_grid</a></span><span class="op">(</span><span class="va">VIIRS</span><span class="op">)</span></span></code></pre></div>
<p>produces the structure:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="st">'data.frame'</span><span class="sc">:</span>   <span class="dv">8833</span> obs. of  <span class="dv">4</span> variables<span class="sc">:</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a> <span class="er">$</span> time     <span class="sc">:</span> POSIXlt, format<span class="sc">:</span> <span class="st">"2017-04-15"</span> <span class="st">"2017-04-15"</span> ...</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a> <span class="sc">$</span> latitude <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">8833</span>(<span class="dv">1</span>d)] <span class="dv">36</span> <span class="fl">36.1</span> <span class="fl">36.1</span> <span class="fl">36.1</span> <span class="fl">36.2</span> ...</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a> <span class="sc">$</span> longitude<span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">8833</span>(<span class="dv">1</span>d)] <span class="sc">-</span><span class="dv">125</span> <span class="sc">-</span><span class="dv">125</span> <span class="sc">-</span><span class="dv">125</span> <span class="sc">-</span><span class="dv">125</span> <span class="sc">-</span><span class="dv">125</span> ...</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a> <span class="sc">$</span> chla     <span class="sc">:</span> num  <span class="fl">0.194</span> <span class="fl">0.193</span> <span class="fl">0.186</span> <span class="fl">0.18</span> <span class="fl">0.163</span> ...</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="crossing-the-date-line">Crossing the date-line<a class="anchor" aria-label="anchor" href="#crossing-the-date-line"></a>
</h3>
<p>The following is an <code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> request that again
uses the MUR dataset and crosses the date-line:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">'jplMURSST41mday'</span><span class="op">)</span></span>
<span><span class="va">parameter</span> <span class="op">&lt;-</span> <span class="st">'sst'</span></span>
<span><span class="va">xcoord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">175</span>, <span class="fl">185</span><span class="op">)</span></span>
<span><span class="va">ycoord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">tcoord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2019-03-16'</span>, <span class="st">'2019-03-16'</span><span class="op">)</span></span>
<span><span class="va">mur_dateline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxtracto_3D.html">rxtracto_3D</a></span><span class="op">(</span><span class="va">dataInfo</span>, <span class="va">parameter</span>, xcoord <span class="op">=</span> <span class="va">xcoord</span>, ycoord <span class="op">=</span> <span class="va">ycoord</span>,</span>
<span>                       tcoord <span class="op">=</span> <span class="va">tcoord</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="plotting-crossing-the-dateline">Plotting crossing the dateline<a class="anchor" aria-label="anchor" href="#plotting-crossing-the-dateline"></a>
</h2>
<p>Plots that cross the date-line need to use the ‘world2’ continental
outlines rather than the default. Due to some problems with that
dataset, some regions must be removed in order to not get artificial
lines.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">170</span>, <span class="fl">190</span><span class="op">)</span></span>
<span><span class="va">ylim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">55</span><span class="op">)</span></span>
<span><span class="va">remove</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"UK:Great Britain"</span>, <span class="st">"France"</span>, <span class="st">"Spain"</span>, <span class="st">"Algeria"</span>, <span class="st">"Mali"</span>, <span class="st">"Burkina Faso"</span>, <span class="st">"Ghana"</span>, <span class="st">"Togo"</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="st">"world2Hires"</span>, xlim <span class="op">=</span> <span class="va">xlim</span>, ylim <span class="op">=</span> <span class="va">ylim</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="st">"mapdata::world2Hires"</span>, regions <span class="op">=</span> <span class="va">w</span><span class="op">$</span><span class="va">names</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">w</span><span class="op">$</span><span class="va">names</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">remove</span><span class="op">)</span><span class="op">]</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">TRUE</span>, ylim <span class="op">=</span> <span class="va">ylim</span>, xlim <span class="op">=</span> <span class="va">xlim</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/plotBBox.html">plotBBox()</a></code> can plot across the date-line, but the x-axis
labels can be incorrect. The data can be plotted using
<code>ggplot2</code>. A function <code>mapFrame()</code> is defined to
help melt the data into a dataframe suitable for <code>ggplot2</code>,
and then plotted using the outline defined above.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mapFrame</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">longitude</span>, <span class="va">latitude</span>, <span class="va">my_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">my_data_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">)</span></span>
<span>  <span class="va">temp_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">dims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">temp_data</span><span class="op">)</span></span>
<span>  <span class="va">temp_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">temp_data</span>, <span class="va">dims</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">dims</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">my_frame</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span></span>
<span>  <span class="va">my_frame</span><span class="op">[</span><span class="va">my_data_name</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">temp_data</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">my_frame</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">mur_frame</span> <span class="op">&lt;-</span> <span class="fu">mapFrame</span><span class="op">(</span><span class="va">mur_dateline</span><span class="op">$</span><span class="va">longitude</span>, <span class="va">mur_dateline</span><span class="op">$</span><span class="va">latitude</span>, <span class="va">mur_dateline</span><span class="op">[</span><span class="st">'sst'</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">mycolor</span> <span class="op">&lt;-</span> <span class="fu">cmocean</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cmocean/man/cmocean.html" class="external-link">cmocean</a></span><span class="op">(</span><span class="st">'thermal'</span><span class="op">)</span><span class="op">(</span><span class="fl">256</span><span class="op">)</span></span>
<span>  <span class="va">myplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mur_frame</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">sst</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">w</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>interpolate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">mycolor</span>, na.value <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="fl">1.3</span>, xlim <span class="op">=</span> <span class="va">xlim</span>, ylim <span class="op">=</span> <span class="va">ylim</span><span class="op">)</span></span>
<span><span class="va">myplot</span></span></code></pre></div>
<p><img src="mur_dateline.png"></p>
</div>
<div class="section level2">
<h2 id="using-rxtractogon">Using <code>rxtractogon</code><a class="anchor" aria-label="anchor" href="#using-rxtractogon"></a>
</h2>
<p>The function <code><a href="../reference/rxtractogon.html">rxtractogon()</a></code> extracts a time-series of
satellite data that are within a user supplied polygon. Two examples are
given. The first extracts chlorophyll within the boundary points of the
Monterey Bay National Marine Sanctuary, available in the
<code>mbnms</code> dataset which is loaded with the
<code>rerddapXtracto</code> package.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/rerddapXtracto" class="external-link">"rerddapXtracto"</a></span><span class="op">)</span></span>
<span><span class="va">dataInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">'erdVH3chlamday'</span><span class="op">)</span></span>
<span><span class="va">parameter</span> <span class="op">=</span> <span class="st">'chla'</span></span>
<span><span class="va">tpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2014-09-01"</span>, <span class="st">"2014-10-01"</span><span class="op">)</span></span>
<span><span class="co">#tpos &lt;-as.Date(tpos)</span></span>
<span><span class="va">xpos</span> <span class="op">&lt;-</span> <span class="va">mbnms</span><span class="op">$</span><span class="va">Longitude</span></span>
<span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="va">mbnms</span><span class="op">$</span><span class="va">Latitude</span></span>
<span><span class="va">sanctchl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxtractogon.html">rxtractogon</a></span><span class="op">(</span><span class="va">dataInfo</span>, parameter <span class="op">=</span> <span class="va">parameter</span>, xcoord <span class="op">=</span> <span class="va">xpos</span>, ycoord <span class="op">=</span> <span class="va">ypos</span>,  tcoord <span class="op">=</span> <span class="va">tpos</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sanctchl</span><span class="op">)</span></span></code></pre></div>
<p>The returned structure is:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>List of <span class="dv">6</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a> <span class="sc">$</span> chla       <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> ...</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a> <span class="sc">$</span> datasetname<span class="sc">:</span> chr <span class="st">"erdVH3chlamday"</span></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a> <span class="sc">$</span> longitude  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>(<span class="dv">1</span>d)] <span class="sc">-</span><span class="dv">123</span> <span class="sc">-</span><span class="dv">123</span> <span class="sc">-</span><span class="dv">123</span> <span class="sc">-</span><span class="dv">123</span> <span class="sc">-</span><span class="dv">123</span> ...</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a> <span class="sc">$</span> latitude   <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">57</span>(<span class="dv">1</span>d)] <span class="fl">35.6</span> <span class="fl">35.6</span> <span class="fl">35.6</span> <span class="fl">35.7</span> <span class="fl">35.7</span> ...</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a> <span class="sc">$</span> altitude   <span class="sc">:</span> logi <span class="cn">NA</span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a> <span class="sc">$</span> time       <span class="sc">:</span> POSIXlt[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], format<span class="sc">:</span> <span class="st">"2014-09-15"</span> <span class="st">"2014-10-15"</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a> <span class="sc">-</span> <span class="fu">attr</span>(<span class="sc">*</span>, <span class="st">"class"</span>)<span class="ot">=</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="st">"list"</span> <span class="st">"rxtracto3D"</span></span></code></pre></div>
<p>The extract (see <code>str(sanctchl)</code>) contains two time
periods of <span style="color:blue">chlorophyll</span> masked for data
only in the sanctuary boundaries. This example shows how to pull out
only a single time period to be used in <code><a href="../reference/plotBBox.html">plotBBox()</a></code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/plotdap" class="external-link">"plotdap"</a></span><span class="op">)</span></span>
<span><span class="va">myFunc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">sanctchl1</span> <span class="op">&lt;-</span> <span class="va">sanctchl</span></span>
<span><span class="va">sanctchl1</span><span class="op">$</span><span class="va">chla</span> <span class="op">&lt;-</span> <span class="va">sanctchl1</span><span class="op">$</span><span class="va">chla</span><span class="op">[</span>, , <span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">sanctchl1</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">sanctchl1</span><span class="op">$</span><span class="va">time</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">sanctchlPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotBBox.html">plotBBox</a></span><span class="op">(</span><span class="va">sanctchl1</span>, plotColor <span class="op">=</span> <span class="st">'algae'</span>, myFunc <span class="op">=</span> <span class="va">myFunc</span><span class="op">)</span></span>
<span><span class="va">sanctchlPlot</span></span></code></pre></div>
<p><img src="sanctchlPlot.png"></p>
<p>The map of the extract can also be animated through time:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://gganimate.com" class="external-link">"gganimate"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: gganimate</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/plotdap" class="external-link">"plotdap"</a></span><span class="op">)</span></span>
<span><span class="va">myFunc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">sanctchlPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotBBox.html">plotBBox</a></span><span class="op">(</span><span class="va">sanctchl</span>, plotColor <span class="op">=</span> <span class="st">'algae'</span>, myFunc <span class="op">=</span> <span class="va">myFunc</span>, time <span class="op">=</span> <span class="va">identity</span>, animate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="sanctuary.gif" alt="Sanctuary Animation"><div class="figcaption">Sanctuary Animation</div>
</div>
<p>The MBNMS is famous for containing the Monterey Canyon, which reaches
depths of up to 3,600 m (11,800 ft) below surface level at its deepest.
<code><a href="../reference/rxtractogon.html">rxtractogon()</a></code> can extract the bathymetry data for the MBNMS
from the <span style="color:red">ETOPO</span> dataset:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/" class="external-link">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">dataInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">'etopo180'</span><span class="op">)</span></span>
<span><span class="va">xpos</span> <span class="op">&lt;-</span> <span class="va">mbnms</span><span class="op">$</span><span class="va">Longitude</span></span>
<span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="va">mbnms</span><span class="op">$</span><span class="va">Latitude</span></span>
<span><span class="va">bathy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxtractogon.html">rxtractogon</a></span><span class="op">(</span><span class="va">dataInfo</span>, parameter <span class="op">=</span> <span class="st">'altitude'</span>, xcoord <span class="op">=</span> <span class="va">xpos</span>, ycoord <span class="op">=</span> <span class="va">ypos</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">bathy</span><span class="op">)</span></span></code></pre></div>
<p>The returned structure is:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>List of <span class="dv">6</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a> <span class="sc">$</span> depth      <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">123</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">141</span>, <span class="dv">1</span>] <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> <span class="cn">NA</span> ...</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a> <span class="sc">$</span> datasetname<span class="sc">:</span> chr <span class="st">"etopo180"</span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a> <span class="sc">$</span> longitude  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">123</span>(<span class="dv">1</span>d)] <span class="sc">-</span><span class="dv">123</span> <span class="sc">-</span><span class="dv">123</span> <span class="sc">-</span><span class="dv">123</span> <span class="sc">-</span><span class="dv">123</span> <span class="sc">-</span><span class="dv">123</span> ...</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a> <span class="sc">$</span> latitude   <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">141</span>(<span class="dv">1</span>d)] <span class="fl">35.5</span> <span class="fl">35.6</span> <span class="fl">35.6</span> <span class="fl">35.6</span> <span class="fl">35.6</span> ...</span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a> <span class="sc">$</span> altitude   <span class="sc">:</span> logi <span class="cn">NA</span></span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a> <span class="sc">$</span> time       <span class="sc">:</span> logi <span class="cn">NA</span></span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a> <span class="sc">-</span> <span class="fu">attr</span>(<span class="sc">*</span>, <span class="st">"class"</span>)<span class="ot">=</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="st">"list"</span> <span class="st">"rxtracto3D"</span></span></code></pre></div>
<p>Mapping the data to show the canyon:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st">"mapdata"</span><span class="op">)</span></span>
<span><span class="va">myFunc</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span><span class="va">x</span></span>
<span><span class="va">bathyPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="../reference/plotBBox.html">plotBBox</a></span><span class="op">(</span><span class="va">bathy</span>, plotColor <span class="op">=</span> <span class="st">'dense'</span>, myFunc <span class="op">=</span> <span class="va">myFunc</span>, name <span class="op">=</span> <span class="st">'Depth'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bathyPlot</span></span></code></pre></div>
<p><img src="bathyPlot.png"></p>
</div>
<div class="section level2">
<h2 id="temperature-at-70m-in-the-north-pacific-from-the-soda-model-output">Temperature at 70m in the north Pacific from the SODA model
output<a class="anchor" aria-label="anchor" href="#temperature-at-70m-in-the-north-pacific-from-the-soda-model-output"></a>
</h2>
<p>This is an example of an extract from a 4-D dataset (results from the
“Simple Ocean Data Assimilation (SODA)” model), and illustrates the case
where the z-coordinate does not have the default name “altitude”. Water
temperature at 70m depth is extracted for the North Pacific Ocean east
of the dateline.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/" class="external-link">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">dataInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">'erdSoda331oceanmday'</span><span class="op">)</span></span>
<span><span class="va">xpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">185.25</span>, <span class="fl">240.25</span><span class="op">)</span></span>
<span><span class="va">ypos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20.25</span>, <span class="fl">60.25</span><span class="op">)</span></span>
<span><span class="va">zpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">76.80285</span>, <span class="fl">76.80285</span><span class="op">)</span></span>
<span><span class="va">tpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2010-12-15'</span>, <span class="st">'2010-12-15'</span><span class="op">)</span></span>
<span><span class="va">soda70</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxtracto_3D.html">rxtracto_3D</a></span><span class="op">(</span><span class="va">dataInfo</span>, parameter <span class="op">=</span> <span class="st">'temp'</span>, xcoord <span class="op">=</span> <span class="va">xpos</span>, ycoord <span class="op">=</span> <span class="va">ypos</span>, tcoord <span class="op">=</span> <span class="va">tpos</span>, zcoord <span class="op">=</span> <span class="va">zpos</span>, zName <span class="op">=</span> <span class="st">'depth'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/plotdap" class="external-link">"plotdap"</a></span><span class="op">)</span></span>
<span><span class="va">sodaPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotBBox.html">plotBBox</a></span><span class="op">(</span><span class="va">soda70</span>, plotColor <span class="op">=</span> <span class="st">'thermal'</span>, name <span class="op">=</span> <span class="st">'temp_at_70m'</span>, maxpixels <span class="op">=</span> <span class="fl">30000</span><span class="op">)</span></span>
<span><span class="va">sodaPlot</span></span></code></pre></div>
<p><img src="soda70.png"></p>
</div>
<div class="section level2">
<h2 id="using-a-different-erddap-server">Using a different ERDDAP server<a class="anchor" aria-label="anchor" href="#using-a-different-erddap-server"></a>
</h2>
<div class="section level3">
<h3 id="hourly">Irish Marine Institute<a class="anchor" aria-label="anchor" href="#hourly"></a>
</h3>
<p>The Irish Marine Institute has an <span style="color:red">ERDDAP</span> server at <a href="https://erddap.marine.ie/erddap/" class="external-link uri">https://erddap.marine.ie/erddap/</a>. Among other datasets,
there is hourly output from a model of the North Atlantic ocean, with a
variety of ocean related parameters, see <a href="https://erddap.marine.ie/erddap/griddap/IMI_NEATL.html" class="external-link uri">https://erddap.marine.ie/erddap/griddap/IMI_NEATL.html</a>.
To obtain sea surface salinity at latest time available for the domain
of the model:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/rerddap/" class="external-link">"rerddap"</a></span><span class="op">)</span></span>
<span><span class="va">urlBase</span> <span class="op">&lt;-</span> <span class="st">"https://erddap.marine.ie/erddap/"</span></span>
<span><span class="va">parameter</span> <span class="op">&lt;-</span> <span class="st">"sea_surface_salinity"</span></span>
<span><span class="va">sssTimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"last"</span>, <span class="st">"last"</span><span class="op">)</span></span>
<span><span class="va">sssLats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">48.00625</span>, <span class="fl">57.50625</span><span class="op">)</span></span>
<span><span class="va">sssLons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">17.99375</span>, <span class="op">-</span><span class="fl">1.00625</span><span class="op">)</span></span>
<span><span class="va">dataInfo</span> <span class="op">&lt;-</span> <span class="fu">rerddap</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rerddap/reference/info.html" class="external-link">info</a></span><span class="op">(</span><span class="st">"IMI_NEATL"</span>, url <span class="op">=</span> <span class="va">urlBase</span><span class="op">)</span></span>
<span><span class="va">NAtlSSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxtracto_3D.html">rxtracto_3D</a></span><span class="op">(</span><span class="va">dataInfo</span>, parameter <span class="op">=</span> <span class="va">parameter</span>, xcoord <span class="op">=</span> <span class="va">sssLons</span>, ycoord <span class="op">=</span> <span class="va">sssLats</span>, tcoord <span class="op">=</span> <span class="va">sssTimes</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/plotdap" class="external-link">"plotdap"</a></span><span class="op">)</span></span>
<span><span class="va">NAtlSSSPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plotBBox.html">plotBBox</a></span><span class="op">(</span><span class="va">NAtlSSS</span>, plotColor <span class="op">=</span> <span class="st">'haline'</span>, name <span class="op">=</span> <span class="st">"salinity"</span>, maxpixels <span class="op">=</span> <span class="fl">30000</span><span class="op">)</span></span>
<span><span class="va">NAtlSSSPlot</span></span></code></pre></div>
<p><img src="NAtlSSSPlot.png"></p>
<p>A lot of the details in the ocean are hidden in the plot above,
because there are some low salinity values right close to shore. The
plot can be modified using the <code>plotdap</code> function
<code><a href="https://rdrr.io/pkg/plotdap/man/add_ggplot.html" class="external-link">add_ggplot()</a></code> so that only values between (32, 36) are
plotted, and to change the colorbar to reflect this.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rmendels/plotdap" class="external-link">"plotdap"</a></span><span class="op">)</span></span>
<span><span class="va">haline</span> <span class="op">=</span> <span class="fu">cmocean</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cmocean/man/cmocean.html" class="external-link">cmocean</a></span><span class="op">(</span><span class="st">'haline'</span><span class="op">)</span><span class="op">(</span><span class="fl">256</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/plotdap/man/add_ggplot.html" class="external-link">add_ggplot</a></span><span class="op">(</span><span class="va">NAtlSSSPlot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_colour_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">haline</span>, na.value <span class="op">=</span> <span class="cn">NA</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">36</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colours <span class="op">=</span> <span class="va">haline</span>, na.value <span class="op">=</span> <span class="cn">NA</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">36</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="NAtlSSSPlot2.png"></p>
</div>
</div>
<div class="section level2">
<h2 id="what-happens-when-you-request-an-extract">What happens when you request an extract<a class="anchor" aria-label="anchor" href="#what-happens-when-you-request-an-extract"></a>
</h2>
<p>When you make an <code>rerddapXtracto</code> request, particularly
for track data using the function <code><a href="../reference/rxtracto.html">rxtracto()</a></code> , it is
important to understand what is extracted, because the remote dataset
requested likely will have a different temporal and spatial resolution
then the local dataset.</p>
<p>Specifically, let <code>longitude</code>, <code>latitude</code> and
<code>time</code> be the coordinate system of the remote <span style="color:red">ERDDAP</span> dataset, and let <code>xpos</code>,
<code>ypos</code> and <code>tpos</code> be the bounds of a request. Then
the <span style="color:red">ERDDAP</span> request is based on the
nearest grid point of the <span style="color:red">ERDDAP</span>
dataset:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">latitude</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">latitude</span> <span class="op">-</span> <span class="va">ypos</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>  <span class="co"># minimum latitude</span></span>
<span><span class="va">latitude</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">latitude</span> <span class="op">-</span> <span class="va">ypos</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>  <span class="co"># maximum latitude</span></span>
<span><span class="va">longitude</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">longitude</span><span class="op">-</span> <span class="va">xpos</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="co"># minimum longitude</span></span>
<span><span class="va">longitude</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">longitude</span> <span class="op">-</span> <span class="va">xpos</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="co"># maximum longitude</span></span>
<span><span class="va">isotime</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">time</span> <span class="op">-</span> <span class="va">tpos</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="co"># minimum time</span></span>
<span><span class="va">isotime</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">time</span> <span class="op">-</span> <span class="va">tpos</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="co"># maximum time</span></span></code></pre></div>
<p>where <code>tpos</code> and <code>time</code> have been converted to
an <span style="color:red">R</span> date format so that it is a number
rather than a string. For example, the FNMOC 6-hourly Ekman transports
are on a 1-degree grid. A request for the data at a longitude of 220.2
and a latitude of 38.7 will return the result at a longitude of 220 and
a latitude of 39. These values are then used in a call to
<code><a href="https://docs.ropensci.org/rerddap/reference/griddap.html" class="external-link">rerddap::griddap()</a></code>, with <code>parameter</code> being the
variable of interest.</p>
</div>
<div class="section level2">
<h2 id="caching">Caching<a class="anchor" aria-label="anchor" href="#caching"></a>
</h2>
<p><code>rerddap</code> caches requests as it’s default behavior. For
the function <code><a href="../reference/rxtracto.html">rxtracto()</a></code>, as a lot of files are downloaded,
these are removed from the cache after each download. For the functions
<code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> and <code>rxtratogon()</code> after
downloading and putting the data into a dataframe, the downloaded netCDF
file is copied from the cache to the present working directory, and
renamed based on the parameter name, and the cached file is removed.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Roy Mendelssohn.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
