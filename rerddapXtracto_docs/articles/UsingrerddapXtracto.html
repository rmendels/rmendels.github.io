<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the rerddapXtracto routines • rerddapXtracto</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Using the rerddapXtracto routines">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rerddapXtracto</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.3.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/UsingrerddapXtracto.html">Using the rerddapXtracto routines</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rmendels/rerddapXtracto">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using the rerddapXtracto routines</h1>
                        <h4 class="author">Roy Mendelssohn</h4>
            
            <h4 class="date">2018-05-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rmendels/rerddapXtracto/blob/master/vignettes/UsingrerddapXtracto.Rmd"><code>vignettes/UsingrerddapXtracto.Rmd</code></a></small>
      <div class="hidden name"><code>UsingrerddapXtracto.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><code>rerddapXtracto</code> is an <span style="color:red">R</span> package developed to subset and extract satellite and other oceanographic related data from any <span style="color:red">ERDDAP</span> server using the <span style="color:red">R</span> package <a href="https://cran.r-project.org/web/packages/rerddap/index.html">rerddap</a> developed by Scott Chamberlain and the wonderful people at <a href="https://ropensci.org">rOpenSci</a>. <span style="color:red">ERDDAP</span> is a simple to use yet powerful web data service developed by Bob Simons. <code>rerddapXtracto</code> extends the <code>rerddap</code> package by being able to extract data for a moving point in time along a user-supplied set of longitude, latitude and time points; and also extracting data within a polygon (through time). <code>rerddapXtracto</code> extends the functionality of the <span style="color:red">R</span> package <a href="https://cran.r-project.org/web/packages/xtractomatic/index.html">xtractomatic</a> by being able to work with (hopefully) most gridded datasets available from any <span style="color:red">ERDDAP</span> server. The disadavantage compared to <code>xtractomatic</code> is that the user has to do more work to obtain information about the dataset to be accessed, while in <code>xtractomatic</code> that information is built in.</p>
<p>This version has several major changes. In both <code><a href="../reference/rxtracto.html">rxtracto()</a></code> and <code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> the zcoord is not limited to be at a set location. That means for <code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> that if the zCoord needs to be given for any reason, then it must be of length two, and for <code><a href="../reference/rxtracto.html">rxtracto()</a></code> if the zCoord needs to be given for any reason, it must be of the same length as the other coordinates, and can also have a “zlen”“, like”xlen" and “ylen”, that defines a bounding box within which to make the extract. The advantage of this is it allows <code><a href="../reference/rxtracto.html">rxtracto()</a></code> to make extracts moving in (x, y, z, t) space.</p>
<p>Second there are now two functions, <code><a href="../reference/plotTrack.html">plotTrack()</a></code> for tracks and <code><a href="../reference/plotBBox.html">plotBBox()</a></code> for grids, that produce quick maps of the output using the <span style="color:red">R</span> package <code>plotdap</code>. All of the examples have been changed to use these functions. Bounding box extracts, as in <code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code>, can be done just using <code>rerddap</code>, but the <code>rerddap</code> function <code><a href="http://www.rdocumentation.org/packages/rerddap/topics/griddap">griddap()</a></code> returns a “melted” version of the data, while <code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> retains the grid structure. Also, <code><a href="../reference/rxtractogon.html">rxtractogon()</a></code> uses <code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> and therefore <code><a href="../reference/plotBBox.html">plotBBox()</a></code> can be used to plot the the results from <code><a href="../reference/rxtractogon.html">rxtractogon()</a></code>. These functions should also work with the output from the <span style="color:red">R</span> package <code>xtractomatic</code>.</p>
<div id="the-main-xtractomatic-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#the-main-xtractomatic-functions" class="anchor"></a>The Main xtractomatic functions</h3>
<p>There are three main data extraction functions in the <code>rerddapXtracto</code> package:</p>
<ul>
<li><p><code>rxtracto &lt;- function(dataInfo, parameter = NULL, xcoord = NULL, ycoord = NULL, zcoord = NULL, tcoord = NULL, xlen = 0., ylen = 0., zlen = 0., xName = 'longitude', yName = 'latitude', zName = 'altitude', tName = 'time', urlbase = 'http://upwell.pfeg.noaa.gov/erddap', verbose = FALSE)</code></p></li>
<li><p><code>rxtracto_3D &lt;- function(dataInfo, parameter = NULL, xcoord = NULL, ycoord = NULL, zcoord = NULL, tcoord = NULL, xName = 'longitude', yName = 'latitude', zName = 'altitude', tName = 'time', urlbase = 'http://upwell.pfeg.noaa.gov/erddap', verbose = FALSE)</code></p></li>
<li><p><code>rxtractogon &lt;- function(dataInfo, parameter, xcoord = NULL, ycoord = NULL, zcoord = NULL, tcoord = NULL, xName = 'longitude', yName = 'latitude', zName = 'altitude', tName = 'time', urlbase = 'http://upwell.pfeg.noaa.gov/erddap', verbose = FALSE)</code></p></li>
</ul>
<p>and two functions for producing maps:</p>
<ul>
<li><p><code>plotTrack &lt;- function(resp, xcoord, ycoord,plotColor = 'viridis', name = NA, myFunc = NA, shape = 20, size = .5)</code></p></li>
<li><p><code>plotBBox &lt;- function(resp, plotColor = 'viridis', time = NA, animate = FALSE, name = NA, myFunc = NA, maxpixels = 10000)</code></p></li>
</ul>
<p>The data extraction functions are similar to but not identical to the functions in <code>xtractomatic</code>. The main differences are having to obtain information about the dataset first using the function <code><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">rerddap::info()</a></code>, and possibly having to give the names of the coordinate variables, as these can’t be assumed (for example the zcoord could be in sigma coordinates). More specifically:</p>
<ul>
<li>dataInfo: the return from an <code><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">rerddap::info()</a></code> call to a dataset on an <span style="color:red">ERDDAP</span> server</li>
<li>parameter: character string containing the name of the parameter to extract</li>
<li>xName: character string with name of the xcoord in the <span style="color:red">ERDDAP</span> dataset (default “longitude”)</li>
<li>yName: character string with name of the ycoord in the <span style="color:red">ERDDAP</span> dataset (default “latitude”)</li>
<li>zName: character string with name of the zcoord in the <span style="color:red">ERDDAP</span> dataset (default “altitude”)</li>
<li>tName: character string with name of the tcoord in the <span style="color:red">ERDDAP</span> dataset (default “time”)</li>
<li>urlbase: base URL of the <span style="color:red">ERDDAP</span> server being accessed - default “<a href="http://upwell.pfeg.noaa.gov/erddap" class="uri">http://upwell.pfeg.noaa.gov/erddap</a>”</li>
<li>verbose: logical variable (default FALSE) if the the URL request should be verbose</li>
</ul>
</div>
<div id="time-has-come-today" class="section level3">
<h3 class="hasAnchor">
<a href="#time-has-come-today" class="anchor"></a>Time has come today</h3>
<p>With all due respect to the <a href="https://www.youtube.com/watch?v=uHfB63ln1Ig">Chambers Brothers</a>, since any <span style="color:red">ERDDAP</span> served gridded data can be accessed, a lot more care must be used with the values of “time” passed to <code>rerddapXtracto</code> as compared with <code>xtractomatic</code>. This is because datasets can have time increments of less than a day, an example of which is <a href="#hourly">given below</a>. <span style="color:red">ERDDAP</span> maps all times to “Zulu” time, of the form “2016-11-01T00:00:00Z”. The date-time “2016-11-01” gets mapped to “2016-11-01T00:00:00Z”. When passing time limits of resolution finer than a day, be certain to take into account time offsets, and to pass the times in the form above. Times are parsed using the <code>parse_date()</code> function of the <a href="https://cran.r-project.org/web/packages/parsedate/index.html">parsedate</a> package, if in doubt you can use that function to see how the times you are passing will be interpreted.</p>
</div>
</div>
<div id="setting-up" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up" class="anchor"></a>Setting up</h2>
<p><code>rerddapXtracto</code> uses the <span style="color:red">R</span> packages <code>rerddap</code>, <code>ncdf4</code>, <code>sp</code> and <code>parsedate</code>, and these packages (and the packages imported by these packages) must be installed first or <code>rerddapXtracto</code> will fail to install.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">"ncdf4"</span>, <span class="dt">dependencies =</span> <span class="ot">TRUE</span>) </a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">install.packages</span>(<span class="st">"parsedate"</span>, <span class="dt">dependencies =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">install.packages</span>(<span class="st">"rerddap"</span>, <span class="dt">dependencies =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">install.packages</span>(<span class="st">"sp"</span>, <span class="dt">dependencies =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>The <code>rerddapXtracto</code> package is not available through <span style="color:blue">CRAN</span> at the moment, but it is available from <a href="https://github.com/rmendels/rerddapXtracto">Github</a></p>
<p>To install the <code>rerddapXtracto</code> package from <span style="color:blue">Github</span> ,</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">"devtools"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"rmendels/rerddapXtracto"</span>)</a></code></pre></div>
<p>Once installed, to use <code>rerddapXtracto</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"rerddapXtracto"</span>)</a></code></pre></div>
<p>To install the plotdap package from <span style="color:blue">Github</span>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">"devtools"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">'ropensci/plotdap'</span>)</a></code></pre></div>
<p>Note that plotdap depends on a number of packages that must be installed. These include the packages ggplot2, raster and sf. To use the animation features, <code>gganimate</code> must be installed, see <a href="https://github.com/dgrtwo/gganimate">gganimate</a>. <code>gganimate</code> requires a version of ImageMagick to be installed on your computer.</p>
<p>If the other <span style="color:red">R</span> libraries (<code>rerddap</code>, <code>ncdf4</code>,<code>sp</code>, and <code>parsedate</code>) have been installed they will be found and do not need to be explicitly loaded.</p>
<div id="using-the-r-code-examples" class="section level3">
<h3 class="hasAnchor">
<a href="#using-the-r-code-examples" class="anchor"></a>Using the R code examples</h3>
<p>Once installed, to use rerddapXtracto:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"rerddapXtracto"</span>)</a></code></pre></div>
<p>and to use the plotting functions:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">library</span>(<span class="st">"plotdap"</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw">library</span>(<span class="st">"sf"</span>)</a></code></pre></div>
</div>
</div>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting Started</h2>
<p>The plotting functions are new, and there are some fine points that neeed to be understood if they are to be used properly, in particular <code><a href="../reference/plotBBox.html">plotBBox()</a></code>. Both plotTrack() and <code><a href="../reference/plotBBox.html">plotBBox()</a></code> rearrange the output so that the plotdap functions add_tabledap() and <code><a href="http://www.rdocumentation.org/packages/plotdap/topics/plotdap">add_griddap()</a></code> think that the output is from <code>rerddap</code>, and then make the appropriate <code>plotdap</code> call. When the data that is passed to <code><a href="http://www.rdocumentation.org/packages/plotdap/topics/plotdap">add_griddap()</a></code> has mutiple time periods, there are two options. The first option is to set the parameter “time” to a function that reduces the data to one dimension in the time coordinate (such as the mean), or else to set “time” equal to “identity” and set “animate” to be “TRUE” which will produce a time animation of the results. The function <code><a href="../reference/plotBBox.html">plotBBox()</a></code> works the same way, except that the default function is <code>mean(na.rm = TRUE)</code>. The following link to examples that show how to use different features of the plotting functions:</p>
<ul>
<li><p><a href="#colorPalette">Setting the color palette</a> shows how to use the “plotColor” option. The “plotColor” parameter can be the name of any of the colors included in the rerddap color pallete. These colors are based on the cmocean colormaps designed by Kristen Thyng (see <a href="http://matplotlib.org/cmocean/" class="uri">http://matplotlib.org/cmocean/</a> and <a href="https://github.com/matplotlib/cmocean" class="uri">https://github.com/matplotlib/cmocean</a>), which were initally developed for Python, but a version of the colormaps is used in the oce package by Dan Kelley and Clark Richards and that is also what is used in rerddap.</p></li>
<li><p><a href="#plot1">Plot one time period</a> example shows how to manipulate an existing output from <code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> or <code>rextractogon()</code> to plot just one time period.</p></li>
<li><p><a href="#transform">Transform the data</a> example shows how to use the “myFunc” option to transform the data before plotting. The function has to be a function of a single argument. This example also shows how to use the “name” option to chnage the name displayed on the color bar. In this example, we want depth to go downwards in the colorbar, and the name given changed from “altitude”, which is the name on ERDDAP, to the name “Depth”.</p></li>
<li><p><a href="#name">Name</a> example shows how to change the name on the colorbar.</p></li>
<li><p><a href="#modify">Modify the graph</a> shows how to use the <code>plotdap</code> functon <code><a href="http://www.rdocumentation.org/packages/plotdap/topics/plotdap">add_ggplot()</a></code> to modify a graph once it has been generated.</p></li>
<li><p><a href="#animate">Animate</a> shows how to animate a grid with multiple time periods.</p></li>
</ul>
<p>The first several examples reproduce some of the examples in the <code>xtractomatic</code> vignette, hopefully to make clear how the functions in the two packages relate. One change from the <code>xtractomatic</code> vignette is that the plots use the <code>cmocean</code> colormaps designed by Kristen Thyng (see <a href="http://matplotlib.org/cmocean/" class="uri">http://matplotlib.org/cmocean/</a> and <a href="https://github.com/matplotlib/cmocean" class="uri">https://github.com/matplotlib/cmocean</a>). These colormaps were initally developed for Python, but a version of the colormaps is used in the <code>oce</code> package by Dan Kelley and Clark Richards and that is what is used here.</p>
<p>The first step is to find the necessary information from the <span style="color:red">ERDDAP</span> server being used. These include the</p>
<ul>
<li>baseURL of the <span style="color:red">ERDDAP</span> server (the default is <a href="http://upwell.pfeg.noaa.gov/erddap" class="uri">http://upwell.pfeg.noaa.gov/erddap</a>)</li>
<li>the datasetID of the data to be accessed (for example the 1-day composite of chloropyhll from MODIS Aqua has a datasetID of ‘erdMBchla1day’ - see <a href="http://upwell.pfeg.noaa.gov/erddap/griddap/erdMBchla1day.html" class="uri">http://upwell.pfeg.noaa.gov/erddap/griddap/erdMBchla1day.html</a>)</li>
<li>the parameter name (in this case “chlorophyll”)</li>
</ul>
<p>In order for <code>rerddapXtracto</code> to have this information, as well as the coordinate variables and their limits, and the parameter names, a call must be made to the <code>rerddap</code> function <code><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">info()</a></code> for the appropriate datasetID and baseURL:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"rerddap"</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; Loading required package: rerddap</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">## base URL does not need to given because it is the default one</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">dataInfo &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">info</a></span>(<span class="st">'erdMBchla1day'</span>)</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">dataInfo</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; &lt;ERDDAP info&gt; erdMBchla1day </span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  Dimensions (range):  </span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;      time: (2006-01-01T12:00:00Z, 2018-05-04T12:00:00Z) </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;      altitude: (0.0, 0.0) </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;      latitude: (-45.0, 65.0) </span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;      longitude: (120.0, 320.0) </span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  Variables:  </span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;      chlorophyll: </span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt;          Units: mg m-3</span></a></code></pre></div>
<div id="an-rxtracto-example" class="section level3">
<h3 class="hasAnchor">
<a href="#an-rxtracto-example" class="anchor"></a>An <code>rxtracto</code> example</h3>
<p>In this section we extract data along a trackline found in the <span style="color:red">Marlintag38606</span> dataset, which is the track of a tagged marlin in the Pacific Ocean (courtesy of Dr. Mike Musyl of the Pelagic Research Group LLC), and show some simple plots of the extracted data.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"rerddap"</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">require</span>(<span class="st">"rerddapXtracto"</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co"># First we will copy the Marlintag38606 data into a variable </span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co"># called tagData  so that subsequent code will be more generic.  </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">tagData &lt;-<span class="st"> </span>Marlintag38606</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">xpos &lt;-<span class="st"> </span>tagData<span class="op">$</span>lon</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">ypos &lt;-<span class="st"> </span>tagData<span class="op">$</span>lat</a>
<a class="sourceLine" id="cb8-10" data-line-number="10">tpos &lt;-<span class="st"> </span>tagData<span class="op">$</span>date</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">zpos &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="fl">0.</span>, <span class="kw">length</span>(xpos))</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">urlbase &lt;-<span class="st"> 'http://upwell.pfeg.noaa.gov/erddap'</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13">swchlInfo &lt;-<span class="st"> </span>rerddap<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">info</a></span>(<span class="st">'erdSWchla8day'</span>)</a>
<a class="sourceLine" id="cb8-14" data-line-number="14">swchl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rxtracto.html">rxtracto</a></span>(swchlInfo, <span class="dt">parameter =</span> <span class="st">'chlorophyll'</span>, <span class="dt">xcoord =</span> xpos, <span class="dt">ycoord =</span> ypos, <span class="dt">tcoord =</span> tpos, <span class="dt">zcoord =</span> zpos, <span class="dt">xlen =</span> <span class="fl">.2</span>, <span class="dt">ylen =</span> <span class="fl">.2</span>)</a></code></pre></div>
<p>Note the differences from the <code>xtractomatic</code> example.</p>
<ul>
<li>the user has to find the datasetID from the given <span style="color:red">ERDDAP</span> server, in this case ‘erdSWchla8day’ (from <a href="http://upwell.pfeg.noaa.gov/erddap/griddap/erdSWchla8day.html" class="uri">http://upwell.pfeg.noaa.gov/erddap/griddap/erdSWchla8day.html</a>)</li>
<li>the user has to call <code><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">rerddap::info('erdSWchla8day')</a></code> to obtain information about that dataset</li>
<li>the user has to know the parameter name desired for that datasetID, in this case ‘chlorophyll’</li>
<li>the zcoord has to be explictily given, because ‘erdSWchla8day’ is a 4-D dataset</li>
</ul>
</div>
<div id="plotting-the-results" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-the-results" class="anchor"></a>Plotting the results</h3>
<p>We plot the track line with the locations colored according to the mean of the satellite <code>chlorophyll</code> around that point. Positions where there was a tag location but no <code>chlorophyll</code> values are also shown. This example shows the use of the “plotColor” parameter to use the “chlorophyll” color palette.</p>
<p><span id="colorPalette"></span></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">require</span>(<span class="st">"plotdap"</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw">require</span>(<span class="st">"sf"</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">myPlot &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plotTrack.html">plotTrack</a></span>(swchl, xpos, ypos, <span class="dt">plotColor =</span> <span class="st">'chlorophyll'</span>)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">myPlot</a></code></pre></div>
<p><img src="UsingrerddapXtracto_files/figure-html/meantrackPlot-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="topography-data" class="section level3">
<h3 class="hasAnchor">
<a href="#topography-data" class="anchor"></a>Topography data</h3>
<p>The second example from the <code>xtractomatic</code> vignette is accessing topographic data along the Marlin track. This example alos shows how to pass a function to <code>plotTrack</code> to transform the data before plotting, and to change the name shown on the colorbar.</p>
<p><span id="name"></span></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="kw">require</span>(<span class="st">"plotdap"</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw">require</span>(<span class="st">"rerddap"</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="kw">require</span>(<span class="st">"rerddapXtracto"</span>)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw">require</span>(<span class="st">"sf"</span>)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">ylim &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">xlim &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">160</span>, <span class="dv">-105</span>)</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">topoInfo &lt;-<span class="st"> </span>rerddap<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">info</a></span>(<span class="st">'etopo360'</span>)</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">topo &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rxtracto.html">rxtracto</a></span>(topoInfo, <span class="dt">parameter =</span> <span class="st">'altitude'</span>, <span class="dt">xcoord =</span> xpos, <span class="dt">ycoord =</span> ypos, <span class="dt">xlen =</span> <span class="fl">.1</span>, <span class="dt">ylen =</span> <span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">myFunc =<span class="st"> </span><span class="cf">function</span>(x) <span class="op">-</span>x</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">topoPlot &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plotTrack.html">plotTrack</a></span>(topo, xpos, ypos, <span class="dt">plotColor =</span> <span class="st">'density'</span>, <span class="dt">name =</span> <span class="st">'Depth'</span>, <span class="dt">myFunc =</span> myFunc)</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">topoPlot</a></code></pre></div>
<p><img src="UsingrerddapXtracto_files/figure-html/topotag-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Again, note the differences from the <code>xtractomatic</code> example:</p>
<ul>
<li>the user has to find the datasetID from the given <span style="color:red">ERDDAP</span> server, in this case ‘etopo360’ (from <a href="http://upwell.pfeg.noaa.gov/erddap/griddap/etopo360.html" class="uri">http://upwell.pfeg.noaa.gov/erddap/griddap/etopo360.html</a>)</li>
<li>the user has to call <code><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">rerddap::info('etopo360')</a></code> to obtain information about that dataset</li>
<li>the user has to know the parameter name desired for that datasetID, in this case ‘altitude’</li>
<li>only the xcoord and ycoord values need to be given, as ‘etopo360’ is a 2-D dataset, and this is handled more gracefully then in <code>xtractomatic</code>.</li>
</ul>
<p>The following is an artificial example showing a track moving in (x, y, z, t) space. Since the times of the model output change, the actual times are retrieved, and the last three times used in the example.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"rerddap"</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">urlBase &lt;-<span class="st"> "http://erddap.marine.ie/erddap/"</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">parameter &lt;-<span class="st"> "Sea_water_temperature"</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4">dataInfo &lt;-<span class="st"> </span>rerddap<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">info</a></span>(<span class="st">"IMI_CONN_3D"</span>, <span class="dt">url =</span> urlBase)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#get the actual last 3 times,  and extract from data frame</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">dataInfo1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">"https://erddap.marine.ie/erddap/griddap/IMI_CONN_3D.csv0?time[last-2:1:last]"</span>,<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>, <span class="dt">header =</span> <span class="ot">FALSE</span>, <span class="dt">row.names =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">sstTimes &lt;-<span class="st"> </span>dataInfo1[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">sstLats &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">53.505758092414446</span>, <span class="fl">53.509303546859805</span>, <span class="fl">53.51284900130517</span>)</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">sstLons &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">10.25975390624996</span>, <span class="fl">-10.247847656249961</span>, <span class="fl">-10.23594140624996</span>)</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">sstDepths &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">sstTrack &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rxtracto.html">rxtracto</a></span>(dataInfo, <span class="dt">parameter =</span> parameter, <span class="dt">xcoord =</span> sstLons, <span class="dt">ycoord =</span> sstLats, <span class="dt">tcoord =</span> sstTimes, <span class="dt">zcoord =</span> sstDepths, <span class="dt">xlen =</span> <span class="fl">.05</span>, <span class="dt">ylen =</span> <span class="fl">.05</span>, <span class="dt">zlen =</span> <span class="fl">0.</span>, <span class="dt">zName =</span> <span class="st">'altitude'</span>, <span class="dt">urlbase =</span> urlBase)</a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="kw">str</span>(sstTrack)</a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; List of 13</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt;  $ mean Sea_water_temperature  : num [1:3] 6.26 5.51 4.88</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt;  $ stdev Sea_water_temperature : num [1:3] 0.4973 0.3875 0.0943</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt;  $ n                           : int [1:3] 493 491 484</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt;  $ satellite date              : chr [1:3] "2018-05-05T22:00:00Z" "2018-05-05T23:00:00Z" "2018-05-06T00:00:00Z"</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt;  $ requested lon min           : num [1:3] -10.3 -10.3 -10.3</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt;  $ requested lon max           : num [1:3] -10.2 -10.2 -10.2</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co">#&gt;  $ requested lat min           : num [1:3] 53.5 53.5 53.5</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="co">#&gt;  $ requested lat max           : num [1:3] 53.5 53.5 53.5</span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co">#&gt;  $ requested z min             : num [1:3] 2 6 10</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="co">#&gt;  $ requested z max             : num [1:3] 2 6 10</span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="co">#&gt;  $ requested date              : chr [1:3] "2018-05-05T22:00:00Z" "2018-05-05T23:00:00Z" "2018-05-06T00:00:00Z"</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="co">#&gt;  $ median Sea_water_temperature: num [1:3] 6.33 5.51 4.87</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="co">#&gt;  $ mad Sea_water_temperature   : num [1:3] 0.3378 0.528 0.0789</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="co">#&gt;  - attr(*, "row.names")= chr [1:3] "1" "2" "3"</span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="co">#&gt;  - attr(*, "class")= chr "rxtractoTrack"</span></a></code></pre></div>
</div>
</div>
<div id="using-rxtracto_3d" class="section level2">
<h2 class="hasAnchor">
<a href="#using-rxtracto_3d" class="anchor"></a>Using <code>rxtracto_3D</code>
</h2>
<p>The function <code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> adds no new capabilites to <code>rerddap</code>, but it does return the data in a structure consistent with the <code>xtractomatic</code> function <code>xtracto_3D()</code>, is used in the function <code><a href="../reference/rxtractogon.html">rxtractogon()</a></code>, and provides a consistent parallel to the functions in the <code>xtractomatic</code> package. It also changes latitudes and longitudes to agree with those of the source dataset, and returns a structure where these are mapped back to the request.</p>
<div id="obtaining-viirs-chlorophyll-data" class="section level3">
<h3 class="hasAnchor">
<a href="#obtaining-viirs-chlorophyll-data" class="anchor"></a>Obtaining VIIRS chlorophyll data</h3>
<p>We examine VIIRS chlorophyll for the “latest” data as of when the vignette was generated:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"rerddap"</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">require</span>(<span class="st">"rerddapXtracto"</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">xpos &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">125</span>, <span class="dv">-120</span>) </a>
<a class="sourceLine" id="cb12-5" data-line-number="5">ypos &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">39</span>, <span class="dv">36</span>)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">tpos &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"last"</span>, <span class="st">"last"</span>)</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">tpos &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"2017-04-15"</span>, <span class="st">"2017-04-15"</span>)</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">VIIRSInfo &lt;-<span class="st"> </span>rerddap<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">info</a></span>(<span class="st">'erdVH3chlamday'</span>)</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">VIIRS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rxtracto_3D.html">rxtracto_3D</a></span>(VIIRSInfo, <span class="dt">parameter =</span> <span class="st">'chla'</span>, <span class="dt">xcoord =</span> xpos, <span class="dt">ycoord =</span> ypos, <span class="dt">tcoord =</span> tpos)</a></code></pre></div>
<p><code>rxtracto_3d()</code> returns a list of the form:</p>
<ul>
<li>VIIRS$chla : num [xcoord, ycoord, tcoord]</li>
<li>VIIRS$datasetname: character string of the ERDDAP dataset ID</li>
<li>VIIRS$longitude : num [xcoord] longitude of extact</li>
<li>VIIRS$latitude : num [ycoord] latitudes of extract</li>
<li>VIIRS$altitude : num zcoord of extract</li>
<li>VIIRS$time : POSIXlt[tcoord] times of extract</li>
</ul>
<p>The coordinate names of the structure are based on the names given in the <code>rxtracto_3d()</code> call, so may differ between datasets. A similar call to <code><a href="http://www.rdocumentation.org/packages/rerddap/topics/griddap">rerddap::griddap()</a></code> will either return the data “pre-melted” (that is long-form) or only get the netcdf file and have the user read in the data. There are tradeoffs to having the data “pre-melted”, for consistency we maintain a structure similar to that in <code>xtracto_3D()</code>, plus this works even if the xcoord and ycoord are not longitude and latitude, where the “pre-melting” in <code><a href="http://www.rdocumentation.org/packages/rerddap/topics/griddap">rerddap::griddap()</a></code> fails.</p>
<p>We can map the data using <code><a href="../reference/plotBBox.html">plotBBox()</a></code>:</p>
<p><span id="transform"></span></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">require</span>(<span class="st">"plotdap"</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">require</span>(<span class="st">"sf"</span>)</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">myFunc &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">log</span>(x)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">chlalogPlot &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plotBBox.html">plotBBox</a></span>(VIIRS, <span class="dt">plotColor =</span> <span class="st">'chlorophyll'</span>, <span class="dt">myFunc =</span> myFunc)</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">chlalogPlot</a></code></pre></div>
<p><img src="UsingrerddapXtracto_files/figure-html/VIIRSLogPlot-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="using-rxtractogon" class="section level2">
<h2 class="hasAnchor">
<a href="#using-rxtractogon" class="anchor"></a>Using <code>rxtractogon</code>
</h2>
<p>The function <code><a href="../reference/rxtractogon.html">rxtractogon()</a></code> extracts a time-series of satellite data that are within a user supplied polygon. We repeat here two of the examples in the <code>xtractomatic</code> vignette. The first gets chlorophyll within the boundary points of the Monterey Bay National Marine Sanctuary, which are available in the <code>mbnms</code> dataset which are loaded with the <code>rerddapXtracto</code> package.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"rerddapXtracto"</span>)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">dataInfo &lt;-<span class="st"> </span>rerddap<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">info</a></span>(<span class="st">'erdVH3chlamday'</span>)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">parameter =<span class="st"> 'chla'</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">tpos &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"2014-09-01"</span>, <span class="st">"2014-10-01"</span>)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#tpos &lt;-as.Date(tpos)</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6">xpos &lt;-<span class="st"> </span>mbnms<span class="op">$</span>Longitude</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">ypos &lt;-<span class="st"> </span>mbnms<span class="op">$</span>Latitude</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">sanctchl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rxtractogon.html">rxtractogon</a></span>(dataInfo, <span class="dt">parameter =</span> parameter, <span class="dt">xcoord =</span> xpos, <span class="dt">ycoord =</span> ypos,  <span class="dt">tcoord =</span> tpos)</a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="kw">str</span>(sanctchl)</a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; List of 6</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt;  $ chla       : num [1:50, 1:57, 1:2] NA NA NA NA NA NA NA NA NA NA ...</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt;  $ datasetname: chr "erdVH3chlamday"</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt;  $ longitude  : num [1:50(1d)] -123 -123 -123 -123 -123 ...</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt;  $ latitude   : num [1:57(1d)] 35.6 35.6 35.6 35.7 35.7 ...</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt;  $ altitude   : logi NA</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">#&gt;  $ time       : POSIXlt[1:2], format: "2014-09-15" "2014-10-15"</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">#&gt;  - attr(*, "class")= chr "rxtracto3D"</span></a></code></pre></div>
<p>The extract (see <code>str(sanctchl)</code>) contains two time periods of <span style="color:blue">chlorophyll</span> masked for data only in the sanctuary boundaries. This example shows how to pull out only a single time period to be used in <code><a href="../reference/plotBBox.html">plotBBox()</a></code>.</p>
<p><span id="plot1"></span></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">require</span>(<span class="st">"plotdap"</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw">require</span>(<span class="st">"sf"</span>)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">myFunc &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">log</span>(x)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">sanctchl1 &lt;-<span class="st"> </span>sanctchl</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">sanctchl1<span class="op">$</span>chla &lt;-<span class="st"> </span>sanctchl1<span class="op">$</span>chla[, , <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">sanctchl1<span class="op">$</span>time &lt;-<span class="st"> </span>sanctchl1<span class="op">$</span>time[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">sanctchlPlot &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plotBBox.html">plotBBox</a></span>(sanctchl1, <span class="dt">plotColor =</span> <span class="st">'chlorophyll'</span>, <span class="dt">myFunc =</span> myFunc)</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">sanctchlPlot</a></code></pre></div>
<p><img src="UsingrerddapXtracto_files/figure-html/mbnmsChlaPlot-1.png" width="576" style="display: block; margin: auto;"></p>
<p>This extract can be used to show the ability to animate the output through time:</p>
<p><span id="animate"></span></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"gganimate"</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co">#&gt; Loading required package: gganimate</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="kw">require</span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="kw">require</span>(<span class="st">"plotdap"</span>)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="kw">require</span>(<span class="st">"sf"</span>)</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">myFunc &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">log</span>(x)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">sanctchlPlot &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plotBBox.html">plotBBox</a></span>(sanctchl, <span class="dt">plotColor =</span> <span class="st">'chlorophyll'</span>, <span class="dt">myFunc =</span> myFunc, <span class="dt">time =</span> identity, <span class="dt">animate =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure">
<img src="ani.gif" alt="Sanctuary Animation"><p class="caption">Sanctuary Animation</p>
</div>
<p>The MBNMS is famous for containing the Monterey Canyon, which reaches depths of up to 3,600 m (11,800 ft) below surface level at its deepest. <code><a href="../reference/rxtractogon.html">rxtractogon()</a></code> can extract the bathymetry data for the MBNMS from the <span style="color:red">ETOPO</span> dataset:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"rerddap"</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">dataInfo &lt;-<span class="st"> </span>rerddap<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">info</a></span>(<span class="st">'etopo180'</span>)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">xpos &lt;-<span class="st"> </span>mbnms<span class="op">$</span>Longitude</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">ypos &lt;-<span class="st"> </span>mbnms<span class="op">$</span>Latitude</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">bathy &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rxtractogon.html">rxtractogon</a></span>(dataInfo, <span class="dt">parameter =</span> <span class="st">'altitude'</span>, <span class="dt">xcoord =</span> xpos, <span class="dt">ycoord =</span> ypos)</a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="kw">str</span>(bathy)</a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="co">#&gt; List of 6</span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt;  $ depth      : num [1:123, 1:141, 1] NA NA NA NA NA NA NA NA NA NA ...</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt;  $ datasetname: chr "etopo180"</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt;  $ longitude  : num [1:123(1d)] -123 -123 -123 -123 -123 ...</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt;  $ latitude   : num [1:141(1d)] 35.5 35.6 35.6 35.6 35.6 ...</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt;  $ altitude   : logi NA</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt;  $ time       : logi NA</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="co">#&gt;  - attr(*, "class")= chr "rxtracto3D"</span></a></code></pre></div>
<p>Mapping the data to show the canyon:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">require</span>(<span class="st">"mapdata"</span>)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">myFunc =<span class="st"> </span><span class="cf">function</span>(x) <span class="op">-</span>x</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">bathyPlot &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plotBBox.html">plotBBox</a></span>(bathy, <span class="dt">plotColor =</span> <span class="st">'density'</span>, <span class="dt">myFunc =</span> myFunc, <span class="dt">name =</span> <span class="st">'Depth'</span>)</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">bathyPlot</a></code></pre></div>
<p><img src="UsingrerddapXtracto_files/figure-html/mbnmsBathyPlot-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="temperature-at-70m-in-the-north-pacific-from-the-soda-model-output" class="section level2">
<h2 class="hasAnchor">
<a href="#temperature-at-70m-in-the-north-pacific-from-the-soda-model-output" class="anchor"></a>Temperature at 70m in the north Pacific from the SODA model output</h2>
<p>This is an example of an extract from a 4-D dataset (results from the “Simple Ocean Data Assimilation (SODA)” model), and illustrate the case where the z-coordinate does not have the default name “altitude”. Water temperature at 70m depth is extracted for the North Pacific Ocean east of the dateline.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"rerddap"</span>)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">dataInfo &lt;-<span class="st"> </span>rerddap<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">info</a></span>(<span class="st">'erdSoda331oceanmday'</span>)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">xpos &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">185.25</span>, <span class="fl">240.25</span>)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">ypos &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">20.25</span>, <span class="fl">60.25</span>)</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">zpos &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">76.80285</span>, <span class="fl">76.80285</span>)</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">tpos &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'2010-12-15'</span>, <span class="st">'2010-12-15'</span>)</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">soda70 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rxtracto_3D.html">rxtracto_3D</a></span>(dataInfo, <span class="dt">parameter =</span> <span class="st">'temp'</span>, <span class="dt">xcoord =</span> xpos, <span class="dt">ycoord =</span> ypos, <span class="dt">tcoord =</span> tpos, <span class="dt">zcoord =</span> zpos, <span class="dt">zName =</span> <span class="st">'depth'</span>)</a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="kw">str</span>(soda70)</a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">#&gt; List of 6</span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="co">#&gt;  $ temp       : num [1:111, 1:81, 1, 1] 25.4 25.3 25.3 25.5 25.3 ...</span></a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="co">#&gt;  $ datasetname: chr "erdSoda331oceanmday"</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="co">#&gt;  $ longitude  : num [1:111(1d)] 185 186 186 187 187 ...</span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13"><span class="co">#&gt;  $ latitude   : num [1:81(1d)] 20.2 20.8 21.2 21.8 22.2 ...</span></a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="co">#&gt;  $ depth      : num [1(1d)] 76.8</span></a>
<a class="sourceLine" id="cb19-15" data-line-number="15"><span class="co">#&gt;  $ time       : POSIXlt[1:1], format: "2010-12-16"</span></a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="co">#&gt;  - attr(*, "class")= chr "rxtracto3D"</span></a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw">require</span>(<span class="st">"plotdap"</span>)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="kw">require</span>(<span class="st">"sf"</span>)</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">sodaPlot &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plotBBox.html">plotBBox</a></span>(soda70, <span class="dt">plotColor =</span> <span class="st">'temperature'</span>, <span class="dt">name =</span> <span class="st">'temp_at_70m'</span>, <span class="dt">maxpixels =</span> <span class="dv">30000</span>)</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">sodaPlot</a></code></pre></div>
<p><img src="UsingrerddapXtracto_files/figure-html/soda70Plot-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="using-a-different-erddap-server" class="section level2">
<h2 class="hasAnchor">
<a href="#using-a-different-erddap-server" class="anchor"></a>Using a different ERDDAP server</h2>
<div id="hourly" class="section level3">
<h3 class="hasAnchor">
<a href="#hourly" class="anchor"></a>Irish Marine Institute</h3>
<p>The Irish Marine Institute has an <span style="color:red">ERDDAP</span> server at <a href="http://erddap.marine.ie/erddap" class="uri">http://erddap.marine.ie/erddap</a>. Among other datasets, there is hourly output from a model of the North Altantic ocean, with a variety of ocean related parameters, see <a href="http://erddap.marine.ie/erddap/griddap/IMI_NEATL.html" class="uri">http://erddap.marine.ie/erddap/griddap/IMI_NEATL.html</a>. To obtain sea surface salinity at latest time available for the domain of the model:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"rerddap"</span>)</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">urlBase &lt;-<span class="st"> "http://erddap.marine.ie/erddap/"</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3">parameter &lt;-<span class="st"> "sea_surface_salinity"</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4">sssTimes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"last"</span>, <span class="st">"last"</span>)</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">sssLats &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">48.00625</span>, <span class="fl">57.50625</span>)</a>
<a class="sourceLine" id="cb21-6" data-line-number="6">sssLons &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">17.99375</span>, <span class="fl">-1.00625</span>)</a>
<a class="sourceLine" id="cb21-7" data-line-number="7">dataInfo &lt;-<span class="st"> </span>rerddap<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">info</a></span>(<span class="st">"IMI_NEATL"</span>, <span class="dt">url =</span> urlBase)</a>
<a class="sourceLine" id="cb21-8" data-line-number="8">NAtlSSS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rxtracto_3D.html">rxtracto_3D</a></span>(dataInfo, <span class="dt">parameter =</span> parameter, <span class="dt">xcoord =</span> sssLons, <span class="dt">ycoord =</span> sssLats, <span class="dt">tcoord =</span> sssTimes, <span class="dt">urlbase =</span> urlBase)</a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="kw">str</span>(NAtlSSS)</a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="co">#&gt; List of 6</span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11"><span class="co">#&gt;  $ sea_surface_salinity: num [1:1360, 1:761, 1] 35.6 35.6 35.6 35.6 35.5 ...</span></a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="co">#&gt;  $ datasetname         : chr "IMI_NEATL"</span></a>
<a class="sourceLine" id="cb21-13" data-line-number="13"><span class="co">#&gt;  $ longitude           : num [1:1360(1d)] -18 -18 -18 -18 -17.9 ...</span></a>
<a class="sourceLine" id="cb21-14" data-line-number="14"><span class="co">#&gt;  $ latitude            : num [1:761(1d)] 48 48 48 48 48.1 ...</span></a>
<a class="sourceLine" id="cb21-15" data-line-number="15"><span class="co">#&gt;  $ altitude            : logi NA</span></a>
<a class="sourceLine" id="cb21-16" data-line-number="16"><span class="co">#&gt;  $ time                : POSIXlt[1:1], format: "2018-05-08"</span></a>
<a class="sourceLine" id="cb21-17" data-line-number="17"><span class="co">#&gt;  - attr(*, "class")= chr "rxtracto3D"</span></a></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="kw">require</span>(<span class="st">"plotdap"</span>)</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">NAtlSSSPlot &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plotBBox.html">plotBBox</a></span>(NAtlSSS, <span class="dt">plotColor =</span> <span class="st">'salinity'</span>, <span class="dt">name =</span> <span class="st">"salinity"</span>, <span class="dt">maxpixels =</span> <span class="dv">30000</span>)</a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="co">#&gt; grid object contains more than 30000 pixels</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="co">#&gt; increase `maxpixels` for a finer resolution</span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6">NAtlSSSPlot</a></code></pre></div>
<p><img src="UsingrerddapXtracto_files/figure-html/NAtlSSSplot-1.png" width="576" style="display: block; margin: auto;"></p>
<p>A lot of the details in the ocean are hidden in the plot above, because there are some low salinity values right close to shore. The plot can be modified using the plotdap function add_ggplot() so that only values between (32, 36) are plotted, and to change the colorbar to reflect this.</p>
<p><span id="modify"></span></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw">require</span>(<span class="st">"plotdap"</span>)</a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="kw"><a href="http://www.rdocumentation.org/packages/plotdap/topics/plotdap">add_ggplot</a></span>(NAtlSSSPlot, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_gradient">scale_colour_gradientn</a></span>(<span class="dt">colours =</span> colors<span class="op">$</span>salinity, <span class="dt">na.value =</span> <span class="ot">NA</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">32</span>, <span class="dv">36</span>)), <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_gradient">scale_fill_gradientn</a></span>(<span class="dt">colours =</span> colors<span class="op">$</span>salinity, <span class="dt">na.value =</span> <span class="ot">NA</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">32</span>, <span class="dv">36</span>)))</a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="co">#&gt; 'colour', which will replace the existing scale.</span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="co">#&gt; Scale for 'fill' is already present. Adding another scale for 'fill',</span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="co">#&gt; which will replace the existing scale.</span></a></code></pre></div>
<p><img src="UsingrerddapXtracto_files/figure-html/NAtlSSSplot1-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="ifremer" class="section level3">
<h3 class="hasAnchor">
<a href="#ifremer" class="anchor"></a>IFREMER</h3>
<p>The French agency IFREMER also has an <span style="color:red">ERDDAP</span> server. We obtain salinity data at 75 meters from the Global Ocean, Coriolis Observation Re-Analysis CORA4.1 model off the west coast of the United States.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"rerddap"</span>)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">urlBase &lt;-<span class="st"> "http://www.ifremer.fr/erddap/"</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3">parameter &lt;-<span class="st"> "PSAL"</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">ifrTimes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"2013-09-15"</span>, <span class="st">"2013-09-15"</span>)</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">ifrLats &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">30.</span>, <span class="fl">50.</span>)</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">ifrLons &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">140.</span>, <span class="fl">-110.</span>)</a>
<a class="sourceLine" id="cb24-7" data-line-number="7">ifrDepth &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">75.</span>, <span class="fl">75.</span>)</a>
<a class="sourceLine" id="cb24-8" data-line-number="8">dataInfo &lt;-<span class="st"> </span>rerddap<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rerddap/topics/info">info</a></span>(<span class="st">"ifremer_tds0_6080_109e_ed80"</span>, <span class="dt">url =</span> urlBase)</a>
<a class="sourceLine" id="cb24-9" data-line-number="9">ifrPSAL &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rxtracto_3D.html">rxtracto_3D</a></span>(dataInfo, <span class="dt">parameter =</span> parameter, <span class="dt">xcoord =</span> ifrLons, <span class="dt">ycoord =</span> ifrLats, <span class="dt">tcoord =</span> ifrTimes, <span class="dt">zcoord =</span> ifrDepth, <span class="dt">zName =</span> <span class="st">'depth'</span>, <span class="dt">urlbase =</span> urlBase)</a>
<a class="sourceLine" id="cb24-10" data-line-number="10"><span class="kw">str</span>(ifrPSAL)</a>
<a class="sourceLine" id="cb24-11" data-line-number="11"><span class="co">#&gt; List of 6</span></a>
<a class="sourceLine" id="cb24-12" data-line-number="12"><span class="co">#&gt;  $ PSAL       : num [1:61, 1:54, 1, 1] 34.8 34.8 34.8 34.7 34.7 ...</span></a>
<a class="sourceLine" id="cb24-13" data-line-number="13"><span class="co">#&gt;  $ datasetname: chr "ifremer_tds0_6080_109e_ed80"</span></a>
<a class="sourceLine" id="cb24-14" data-line-number="14"><span class="co">#&gt;  $ longitude  : num [1:61(1d)] -140 -140 -139 -138 -138 ...</span></a>
<a class="sourceLine" id="cb24-15" data-line-number="15"><span class="co">#&gt;  $ latitude   : num [1:54(1d)] 30 30.5 30.9 31.3 31.7 ...</span></a>
<a class="sourceLine" id="cb24-16" data-line-number="16"><span class="co">#&gt;  $ depth      : num [1(1d)] 75</span></a>
<a class="sourceLine" id="cb24-17" data-line-number="17"><span class="co">#&gt;  $ time       : POSIXlt[1:1], format: "2013-09-15"</span></a>
<a class="sourceLine" id="cb24-18" data-line-number="18"><span class="co">#&gt;  - attr(*, "class")= chr "rxtracto3D"</span></a></code></pre></div>
<p>Plotting th results using <code><a href="../reference/plotBBox.html">plotBBox()</a></code>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">require</span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="kw">require</span>(<span class="st">"plotdap"</span>)</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">ifrPSALPlot &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plotBBox.html">plotBBox</a></span>(ifrPSAL, <span class="dt">plotColor =</span> <span class="st">'salinity'</span>, <span class="dt">name =</span> <span class="st">"salinity"</span>, <span class="dt">maxpixels =</span> <span class="dv">30000</span>)</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">ifrPSALPlot</a></code></pre></div>
<p><img src="UsingrerddapXtracto_files/figure-html/ifrPSALplot-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="what-happens-when-you-request-an-extract" class="section level2">
<h2 class="hasAnchor">
<a href="#what-happens-when-you-request-an-extract" class="anchor"></a>What happens when you request an extract</h2>
<p>When you make an <code>rerddapXtracto</code> request, particularly for track data using the function <code><a href="../reference/rxtracto.html">rxtracto()</a></code> , it is important to understand what is extracted, because the remote dataset requested likely will have a different temporal and spatial resolution then the local dataset.</p>
<p>Specifically, let <code>longitude</code>, <code>latitude</code> and <code>time</code> be the coordinate system of the remote <span style="color:red">ERDDAP</span> dataset, and let <code>xpos</code>, <code>ypos</code> and <code>tpos</code> be the bounds of a request. Then the <span style="color:red">ERDDAP</span> request is based on the nearest grid point of the <span style="color:red">ERDDAP</span> dataset:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">latitude[<span class="kw">which.min</span>(<span class="kw">abs</span>(latitude <span class="op">-</span><span class="st"> </span>ypos[<span class="dv">1</span>]))]  <span class="co"># minimum latitude</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">latitude[<span class="kw">which.min</span>(<span class="kw">abs</span>(latitude <span class="op">-</span><span class="st"> </span>ypos[<span class="dv">2</span>]))]  <span class="co"># maximum latitude</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3">longitude[<span class="kw">which.min</span>(<span class="kw">abs</span>(longitude<span class="op">-</span><span class="st"> </span>xpos[<span class="dv">1</span>]))] <span class="co"># minimum longitude</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4">longitude[<span class="kw">which.min</span>(<span class="kw">abs</span>(longitude <span class="op">-</span><span class="st"> </span>xpos[<span class="dv">2</span>]))] <span class="co"># maximum longitude</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5">isotime[<span class="kw">which.min</span>(<span class="kw">abs</span>(time <span class="op">-</span><span class="st"> </span>tpos[<span class="dv">1</span>]))] <span class="co"># minimum time</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6">isotime[<span class="kw">which.min</span>(<span class="kw">abs</span>(time <span class="op">-</span><span class="st"> </span>tpos[<span class="dv">2</span>]))] <span class="co"># maximum time</span></a></code></pre></div>
<p>where <code>tpos</code> and <code>time</code> have been converted to an <span style="color:red">R</span> date format so that it is a number rather than a string. For example, the FNMOC 6-hourly Ekman transports are on a 1-degree grid. A request for the data at a longitude of 220.2 and a latitude of 38.7 will return the result at a longtiude of 220 and a latitude of 39. These values are then used in a call to <code><a href="http://www.rdocumentation.org/packages/rerddap/topics/griddap">rerddap::griddap()</a></code>, with <code>parameter</code> being the variable of interest.</p>
</div>
<div id="cacheing" class="section level2">
<h2 class="hasAnchor">
<a href="#cacheing" class="anchor"></a>Cacheing</h2>
<p><code>rerddap</code> caches requests as it’s default behavior. For the function <code><a href="../reference/rxtracto.html">rxtracto()</a></code>, as a lot of files are downloaded, these are removed from the cache after each download. For the functions <code><a href="../reference/rxtracto_3D.html">rxtracto_3D()</a></code> and <code>rxtratogon()</code> after downloading and putting the data into a dataframe, the downloaded netCDF file is copied from the cache to the present working directory, and renamed based on the parameter name, and the cached file is removed.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#setting-up">Setting up</a></li>
      <li><a href="#getting-started">Getting Started</a></li>
      <li><a href="#using-rxtracto_3d">Using <code>rxtracto_3D</code></a></li>
      <li><a href="#using-rxtractogon">Using <code>rxtractogon</code></a></li>
      <li><a href="#temperature-at-70m-in-the-north-pacific-from-the-soda-model-output">Temperature at 70m in the north Pacific from the SODA model output</a></li>
      <li><a href="#using-a-different-erddap-server">Using a different ERDDAP server</a></li>
      <li><a href="#what-happens-when-you-request-an-extract">What happens when you request an extract</a></li>
      <li><a href="#cacheing">Cacheing</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Roy Mendelssohn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
